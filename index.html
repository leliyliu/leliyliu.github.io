<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="record">
<meta property="og:type" content="website">
<meta property="og:title" content="ç¦¾å£°">
<meta property="og:url" content="http://leliyliu.github.io/index.html">
<meta property="og:site_name" content="ç¦¾å£°">
<meta property="og:description" content="record">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç¦¾å£°">
<meta name="twitter:description" content="record">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://leliyliu.github.io/">





  <title>ç¦¾å£°</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç¦¾å£°</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">in the arm of the angel, fly away</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2020/02/24/pytorch3/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/24/pytorch3/" itemprop="url">pytorch3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-24T11:31:58+08:00">
                2020-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="pytorch3"><a href="#pytorch3" class="headerlink" title="pytorch3"></a>pytorch3</h1><hr>
<h2 id="æ‰¹é‡å½’ä¸€åŒ–å’Œæ®‹å·®ç½‘ç»œ"><a href="#æ‰¹é‡å½’ä¸€åŒ–å’Œæ®‹å·®ç½‘ç»œ" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–å’Œæ®‹å·®ç½‘ç»œ"></a>æ‰¹é‡å½’ä¸€åŒ–å’Œæ®‹å·®ç½‘ç»œ</h2><p>åˆ©ç”¨å°æ‰¹é‡ä¸Šçš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œä¸æ–­è°ƒæ•´ç¥ç»ç½‘ç»œä¸­é—´è¾“å‡ºï¼Œä»è€Œä½¿æ•´ä¸ªç¥ç»ç½‘ç»œåœ¨å„å±‚çš„ä¸­é—´è¾“å‡ºçš„æ•°å€¼æ›´ç¨³å®šã€‚</p>
<h3 id="å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–"><a href="#å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–"></a>å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–</h3><p>ä½ç½®ï¼šå…¨è¿æ¥å±‚ä¸­çš„ä»¿å°„å˜æ¢å’Œæ¿€æ´»å‡½æ•°ä¹‹é—´ã€‚<br><strong>å…¨è¿æ¥ï¼š</strong>  </p>
<script type="math/tex; mode=display">
\boldsymbol{x} = \boldsymbol{W\boldsymbol{u} + \boldsymbol{b}} \\
 output =\phi(\boldsymbol{x})</script><p><strong>æ‰¹é‡å½’ä¸€åŒ–ï¼š</strong></p>
<script type="math/tex; mode=display">
output=\phi(\text{BN}(\boldsymbol{x}))</script><script type="math/tex; mode=display">
\boldsymbol{y}^{(i)} = \text{BN}(\boldsymbol{x}^{(i)})</script><script type="math/tex; mode=display">
\boldsymbol{\mu}_\mathcal{B} \leftarrow \frac{1}{m}\sum_{i = 1}^{m} \boldsymbol{x}^{(i)},</script><script type="math/tex; mode=display">
\boldsymbol{\sigma}_\mathcal{B}^2 \leftarrow \frac{1}{m} \sum_{i=1}^{m}(\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_\mathcal{B})^2,</script><script type="math/tex; mode=display">
\hat{\boldsymbol{x}}^{(i)} \leftarrow \frac{\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_\mathcal{B}}{\sqrt{\boldsymbol{\sigma}_\mathcal{B}^2 + \epsilon}},</script><p>è¿™â¾¥Ïµ &gt; 0æ˜¯ä¸ªå¾ˆå°çš„å¸¸æ•°ï¼Œä¿è¯åˆ†æ¯å¤§äº0</p>
<script type="math/tex; mode=display">
{\boldsymbol{y}}^{(i)} \leftarrow \boldsymbol{\gamma} \odot
\hat{\boldsymbol{x}}^{(i)} + \boldsymbol{\beta}.</script><p>å¼•å…¥å¯å­¦ä¹ å‚æ•°ï¼šæ‹‰ä¼¸å‚æ•°Î³å’Œåç§»å‚æ•°Î²ã€‚è‹¥$\boldsymbol{\gamma} = \sqrt{\boldsymbol{\sigma}_\mathcal{B}^2 + \epsilon}$å’Œ$\boldsymbol{\beta} = \boldsymbol{\mu}_\mathcal{B}$ï¼Œæ‰¹é‡å½’ä¸€åŒ–æ— æ•ˆã€‚</p>
<h3 id="å¯¹å·ç§¯å±‚åšæ‰¹é‡å½’â¼€åŒ–"><a href="#å¯¹å·ç§¯å±‚åšæ‰¹é‡å½’â¼€åŒ–" class="headerlink" title="å¯¹å·ç§¯å±‚åšæ‰¹é‡å½’â¼€åŒ–"></a>å¯¹å·ç§¯å±‚åšæ‰¹é‡å½’â¼€åŒ–</h3><p>ä½ç½®ï¼šå·ç§¯è®¡ç®—ä¹‹åã€åº”â½¤æ¿€æ´»å‡½æ•°ä¹‹å‰ã€‚<br>å¦‚æœå·ç§¯è®¡ç®—è¾“å‡ºå¤šä¸ªé€šé“ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›é€šé“çš„è¾“å‡ºåˆ†åˆ«åšæ‰¹é‡å½’ä¸€åŒ–ï¼Œä¸”æ¯ä¸ªé€šé“éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„æ‹‰ä¼¸å’Œåç§»å‚æ•°ã€‚<br>è®¡ç®—ï¼šå¯¹å•é€šé“ï¼Œbatchsize=m,å·ç§¯è®¡ç®—è¾“å‡º=pxq<br>å¯¹è¯¥é€šé“ä¸­mÃ—pÃ—qä¸ªå…ƒç´ åŒæ—¶åšæ‰¹é‡å½’ä¸€åŒ–,ä½¿ç”¨ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®ã€‚</p>
<h3 id="é¢„æµ‹æ—¶çš„æ‰¹é‡å½’â¼€åŒ–"><a href="#é¢„æµ‹æ—¶çš„æ‰¹é‡å½’â¼€åŒ–" class="headerlink" title="é¢„æµ‹æ—¶çš„æ‰¹é‡å½’â¼€åŒ–"></a>é¢„æµ‹æ—¶çš„æ‰¹é‡å½’â¼€åŒ–</h3><p>è®­ç»ƒï¼šä»¥batchä¸ºå•ä½,å¯¹æ¯ä¸ªbatchè®¡ç®—å‡å€¼å’Œæ–¹å·®ã€‚<br>é¢„æµ‹ï¼šç”¨ç§»åŠ¨å¹³å‡ä¼°ç®—æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬å‡å€¼å’Œæ–¹å·®ã€‚</p>
<h3 id="æ®‹å·®ç½‘ç»œ"><a href="#æ®‹å·®ç½‘ç»œ" class="headerlink" title="æ®‹å·®ç½‘ç»œ"></a>æ®‹å·®ç½‘ç»œ</h3><p>æ·±åº¦å­¦ä¹ çš„é—®é¢˜ï¼šæ·±åº¦CNNç½‘ç»œè¾¾åˆ°ä¸€å®šæ·±åº¦åå†ä¸€å‘³åœ°å¢åŠ å±‚æ•°å¹¶ä¸èƒ½å¸¦æ¥è¿›ä¸€æ­¥åœ°åˆ†ç±»æ€§èƒ½æé«˜ï¼Œåè€Œä¼šæ‹›è‡´ç½‘ç»œæ”¶æ•›å˜å¾—æ›´æ…¢ï¼Œå‡†ç¡®ç‡ä¹Ÿå˜å¾—æ›´å·®ã€‚</p>
<h4 id="æ®‹å·®å—ï¼ˆResidual-Blockï¼‰"><a href="#æ®‹å·®å—ï¼ˆResidual-Blockï¼‰" class="headerlink" title="æ®‹å·®å—ï¼ˆResidual Blockï¼‰"></a>æ®‹å·®å—ï¼ˆResidual Blockï¼‰</h4><p>æ’ç­‰æ˜ å°„ï¼š<br>å·¦è¾¹ï¼šf(x)=x<br>å³è¾¹ï¼šf(x)-x=0 ï¼ˆæ˜“äºæ•æ‰æ’ç­‰æ˜ å°„çš„ç»†å¾®æ³¢åŠ¨ï¼‰</p>
<p><img src="https://cdn.kesci.com/upload/image/q5l8lhnot4.png?imageView2/0/w/600/h/600" alt="Image Name"></p>
<p>åœ¨æ®‹å·®å—ä¸­ï¼Œè¾“â¼Šå¯é€šè¿‡è·¨å±‚çš„æ•°æ®çº¿è·¯æ›´å¿« åœ°å‘å‰ä¼ æ’­ã€‚</p>
<h2 id="å‡¸ä¼˜åŒ–"><a href="#å‡¸ä¼˜åŒ–" class="headerlink" title="å‡¸ä¼˜åŒ–"></a>å‡¸ä¼˜åŒ–</h2><h3 id="ä¼˜åŒ–ä¸ä¼°è®¡"><a href="#ä¼˜åŒ–ä¸ä¼°è®¡" class="headerlink" title="ä¼˜åŒ–ä¸ä¼°è®¡"></a>ä¼˜åŒ–ä¸ä¼°è®¡</h3><p>å°½ç®¡ä¼˜åŒ–æ–¹æ³•å¯ä»¥æœ€å°åŒ–æ·±åº¦å­¦ä¹ ä¸­çš„æŸå¤±å‡½æ•°å€¼ï¼Œä½†æœ¬è´¨ä¸Šä¼˜åŒ–æ–¹æ³•è¾¾åˆ°çš„ç›®æ ‡ä¸æ·±åº¦å­¦ä¹ çš„ç›®æ ‡å¹¶ä¸ç›¸åŒã€‚</p>
<ul>
<li>ä¼˜åŒ–æ–¹æ³•ç›®æ ‡ï¼šè®­ç»ƒé›†æŸå¤±å‡½æ•°å€¼</li>
<li>æ·±åº¦å­¦ä¹ ç›®æ ‡ï¼šæµ‹è¯•é›†æŸå¤±å‡½æ•°å€¼ï¼ˆæ³›åŒ–æ€§ï¼‰</li>
</ul>
<h3 id="ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜"><a href="#ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜" class="headerlink" title="ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜"></a>ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜</h3><h4 id="å±€éƒ¨æœ€å°å€¼"><a href="#å±€éƒ¨æœ€å°å€¼" class="headerlink" title="å±€éƒ¨æœ€å°å€¼"></a>å±€éƒ¨æœ€å°å€¼</h4><h4 id="éç‚¹"><a href="#éç‚¹" class="headerlink" title="éç‚¹"></a>éç‚¹</h4><h4 id="æ¢¯åº¦æ¶ˆå¤±"><a href="#æ¢¯åº¦æ¶ˆå¤±" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±"></a>æ¢¯åº¦æ¶ˆå¤±</h4><h3 id="å‡¸æ€§"><a href="#å‡¸æ€§" class="headerlink" title="å‡¸æ€§"></a>å‡¸æ€§</h3><p>åœ¨å‡¸æ€§ä¸‹ï¼Œä¼˜åŒ–å˜å¾—å®¹æ˜“è¢«è§£å†³ã€‚</p>
<h4 id="Jensen-ä¸ç­‰å¼"><a href="#Jensen-ä¸ç­‰å¼" class="headerlink" title="Jensen ä¸ç­‰å¼"></a>Jensen ä¸ç­‰å¼</h4><script type="math/tex; mode=display">
\sum_{i} \alpha_{i} f\left(x_{i}\right) \geq f\left(\sum_{i} \alpha_{i} x_{i}\right) \text { and } E_{x}[f(x)] \geq f\left(E_{x}[x]\right)</script><p>å³å‡½æ•°å€¼çš„æœŸæœ›å¤§äºæœŸæœ›çš„å‡½æ•°å€¼</p>
<p>$f^{â€˜â€™}(x) \ge 0 \Longleftrightarrow f(x)$ æ˜¯å‡¸å‡½æ•°</p>
<p><strong>å¿…è¦æ€§ ($\Leftarrow$):</strong></p>
<p>å¯¹äºå‡¸å‡½æ•°ï¼š</p>
<script type="math/tex; mode=display">
\frac{1}{2} f(x+\epsilon)+\frac{1}{2} f(x-\epsilon) \geq f\left(\frac{x+\epsilon}{2}+\frac{x-\epsilon}{2}\right)=f(x)</script><p>æ•…:</p>
<script type="math/tex; mode=display">
f^{\prime \prime}(x)=\lim _{\varepsilon \rightarrow 0} \frac{\frac{f(x+\epsilon) - f(x)}{\epsilon}-\frac{f(x) - f(x-\epsilon)}{\epsilon}}{\epsilon}</script><script type="math/tex; mode=display">
f^{\prime \prime}(x)=\lim _{\varepsilon \rightarrow 0} \frac{f(x+\epsilon)+f(x-\epsilon)-2 f(x)}{\epsilon^{2}} \geq 0</script><p><strong>å……åˆ†æ€§ ($\Rightarrow$):</strong></p>
<p>ä»¤ $a &lt; x &lt; b$ ä¸º $f(x)$ ä¸Šçš„ä¸‰ä¸ªç‚¹ï¼Œç”±æ‹‰æ ¼æœ—æ—¥ä¸­å€¼å®šç†:</p>
<script type="math/tex; mode=display">
\begin{array}{l}{f(x)-f(a)=(x-a) f^{\prime}(\alpha) \text { for some } \alpha \in[a, x] \text { and }} \\ {f(b)-f(x)=(b-x) f^{\prime}(\beta) \text { for some } \beta \in[x, b]}\end{array}</script><p>æ ¹æ®å•è°ƒæ€§ï¼Œæœ‰ $f^{\prime}(\beta) \geq f^{\prime}(\alpha)$, æ•…:</p>
<script type="math/tex; mode=display">
\begin{aligned} f(b)-f(a) &=f(b)-f(x)+f(x)-f(a) \\ &=(b-x) f^{\prime}(\beta)+(x-a) f^{\prime}(\alpha) \\ & \geq(b-a) f^{\prime}(\alpha) \end{aligned}</script><h2 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h2><h3 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a>ç‰›é¡¿æ³•</h3><p>åœ¨ $x + \epsilon$ å¤„æ³°å‹’å±•å¼€ï¼š</p>
<script type="math/tex; mode=display">
f(\mathbf{x}+\epsilon)=f(\mathbf{x})+\epsilon^{\top} \nabla f(\mathbf{x})+\frac{1}{2} \epsilon^{\top} \nabla \nabla^{\top} f(\mathbf{x}) \epsilon+\mathcal{O}\left(\|\epsilon\|^{3}\right)</script><p>æœ€å°å€¼ç‚¹å¤„æ»¡è¶³: $\nabla f(\mathbf{x})=0$, å³æˆ‘ä»¬å¸Œæœ› $\nabla f(\mathbf{x} + \epsilon)=0$, å¯¹ä¸Šå¼å…³äº $\epsilon$ æ±‚å¯¼ï¼Œå¿½ç•¥é«˜é˜¶æ— ç©·å°ï¼Œæœ‰ï¼š</p>
<script type="math/tex; mode=display">
\nabla f(\mathbf{x})+\boldsymbol{H}_{f} \boldsymbol{\epsilon}=0 \text { and hence } \epsilon=-\boldsymbol{H}_{f}^{-1} \nabla f(\mathbf{x})</script><h3 id="åŠ¨æ€å­¦ä¹ ç‡"><a href="#åŠ¨æ€å­¦ä¹ ç‡" class="headerlink" title="åŠ¨æ€å­¦ä¹ ç‡"></a>åŠ¨æ€å­¦ä¹ ç‡</h3><script type="math/tex; mode=display">
\begin{array}{ll}{\eta(t)=\eta_{i} \text { if } t_{i} \leq t \leq t_{i+1}} & {\text { piecewise constant }} \\ {\eta(t)=\eta_{0} \cdot e^{-\lambda t}} & {\text { exponential }} \\ {\eta(t)=\eta_{0} \cdot(\beta t+1)^{-\alpha}} & {\text { polynomial }}\end{array}</script><h2 id="è¡¥å……ï¼šçŸ©é˜µå¾®ç§¯åˆ†"><a href="#è¡¥å……ï¼šçŸ©é˜µå¾®ç§¯åˆ†" class="headerlink" title="è¡¥å……ï¼šçŸ©é˜µå¾®ç§¯åˆ†"></a>è¡¥å……ï¼šçŸ©é˜µå¾®ç§¯åˆ†</h2><p>åœ¨æ•°å­¦ä¸­ï¼ŒçŸ©é˜µå¾®ç§¯åˆ†æ˜¯è¿›è¡Œå¤šå˜é‡å¾®ç§¯åˆ†çš„ä¸€ç§ç‰¹æ®Šç¬¦å·ï¼Œç‰¹åˆ«æ˜¯åœ¨çŸ©é˜µçš„ç©ºé—´ä¸Šã€‚  å®ƒå°†å…³äºè®¸å¤šå˜é‡çš„å•ä¸ªå‡½æ•°çš„å„ç§åå¯¼æ•°å’Œ/æˆ–å…³äºå•ä¸ªå˜é‡çš„å¤šå˜é‡å‡½æ•°çš„åå¯¼æ•°æ”¶é›†åˆ°å¯ä»¥è¢«è§†ä¸ºå•ä¸ªå®ä½“çš„å‘é‡å’ŒçŸ©é˜µä¸­ã€‚  è¿™å¤§å¤§ç®€åŒ–ä¾‹å¦‚æ‰¾åˆ°å¤šå…ƒå‡½æ•°çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼Œä»¥åŠæ±‚è§£å¾®åˆ†æ–¹ç¨‹ç»„çš„æ“ä½œã€‚  è¿™é‡Œä½¿ç”¨çš„ç¬¦å·é€šå¸¸ç”¨äºç»Ÿè®¡å’Œå·¥ç¨‹ä¸­ï¼Œè€Œå¼ é‡æŒ‡æ•°ç¬¦å·åœ¨ç‰©ç†å­¦ä¸­æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ã€‚ </p>
<p>çŸ©é˜µå¾®ç§¯åˆ†æ˜¯æŒ‡ä¸€ç»„ä¸åŒçš„ç¬¦å·ï¼Œè¿™ç»„ç¬¦å·ä½¿ç”¨çŸ©é˜µå’Œå‘é‡æ¥æ”¶é›†å› å˜é‡çš„æ¯ä¸ªåˆ†é‡ç›¸å¯¹äºè‡ªå˜é‡çš„æ¯ä¸ªåˆ†é‡çš„å¯¼æ•°ã€‚æ€»çš„æ¥è¯´ï¼Œè‡ªå˜é‡å¯ä»¥æ˜¯æ ‡é‡ï¼Œå‘é‡ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå› å˜é‡ä¹Ÿå¯ä»¥æ˜¯ä¸Šè¿°çš„ä¸‰è€…ä¹‹ä¸€ã€‚æ¯ä¸€ç§ä¸åŒçš„è‡ªå˜é‡å’Œå› å˜é‡çš„ç»„åˆéƒ½æœ‰ä¸åŒçš„ä¸€å¥—è¿ç®—è§„åˆ™ã€‚</p>
<p>å‰é¢ä¸¤ç§æƒ…å†µä¸­çš„æ¯ä¸€ç§éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä½¿ç”¨é€‚å½“å¤§å°çš„å‘é‡å¯¹å‘é‡æ±‚å¯¼æ•°çš„åº”ç”¨ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å°†å‘ç°æ¶‰åŠçŸ©é˜µçš„å¯¼æ•°å°†ä»¥ç›¸åº”çš„æ–¹å¼å‡å°‘åˆ°æ¶‰åŠå‘é‡çš„å¯¼æ•°ã€‚<br> å¯¹å‡½æ•°å‘é‡(ä¸€ä¸ªå‘é‡å…¶ç»„æˆæ˜¯å‡½æ•°)$\mathbf{y}=\left[\begin{aligned}\begin{matrix}y_1\\y_2\\\vdots\\y_m\end{matrix}\end{aligned}\right]$ï¼Œå¯¹ä¸€ä¸ªè¾“å…¥å‘é‡$\mathbf{x}=\left[\begin{aligned}\begin{matrix}x_1\\x_2\\\vdots\\x_m\end{matrix}\end{aligned}\right]$æ±‚å¯¼ï¼ˆä½¿ç”¨åˆ†å­å¸ƒå±€ï¼‰ï¼Œå¯ä»¥å†™æˆï¼š </p>
<script type="math/tex; mode=display">
\dfrac{\partial\mathbf{y}}{\partial\mathbf{x}}=
\left[
\begin{aligned}
\begin{matrix}
\dfrac{\partial{y_1}}{\partial{x_1}}&\dfrac{\partial{y_1}}{\partial{x_2}}&\cdots&\dfrac{\partial{y_1}}{\partial{x_n}}\\
\dfrac{\partial{y_2}}{\partial{x_1}}&\dfrac{\partial{y_2}}{\partial{x_2}}&\cdots&\dfrac{\partial{y_2}}{\partial{x_n}}\\
\vdots&\vdots&\ddots&\vdots\\
\dfrac{\partial{y_m}}{\partial{x_1}}&\dfrac{\partial{y_m}}{\partial{x_2}}&\cdots&\dfrac{\partial{y_m}}{\partial{x_n}}\\
\end{matrix}
\end{aligned}
\right]</script><p>è¿™é‡Œå±•ç¤ºçš„æ˜¯åŸºç¡€ï¼Œå…³äºæ›´å¤šå†…å®¹ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢<a href="https://zhuanlan.zhihu.com/p/24709748" target="_blank" rel="noopener">çŸ©é˜µæ±‚å¯¼æœ¯</a></p>
<h2 id="ä¼˜åŒ–ç®—æ³•è¿›é˜¶"><a href="#ä¼˜åŒ–ç®—æ³•è¿›é˜¶" class="headerlink" title="ä¼˜åŒ–ç®—æ³•è¿›é˜¶"></a>ä¼˜åŒ–ç®—æ³•è¿›é˜¶</h2><p>åœ¨ <a href="https://d2l.ai/chapter_optimization/sgd.html#sec-sgd" target="_blank" rel="noopener">Section 11.4</a> ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œç›®æ ‡å‡½æ•°æœ‰å…³è‡ªå˜é‡çš„æ¢¯åº¦ä»£è¡¨äº†ç›®æ ‡å‡½æ•°åœ¨è‡ªå˜é‡å½“å‰ä½ç½®ä¸‹é™æœ€å¿«çš„æ–¹å‘ã€‚å› æ­¤ï¼Œæ¢¯åº¦ä¸‹é™ä¹Ÿå«ä½œæœ€é™¡ä¸‹é™ï¼ˆsteepest descentï¼‰ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ¢¯åº¦ä¸‹é™æ ¹æ®è‡ªå˜é‡å½“å‰ä½ç½®ï¼Œæ²¿ç€å½“å‰ä½ç½®çš„æ¢¯åº¦æ›´æ–°è‡ªå˜é‡ã€‚ç„¶è€Œï¼Œå¦‚æœè‡ªå˜é‡çš„è¿­ä»£æ–¹å‘ä»…ä»…å–å†³äºè‡ªå˜é‡å½“å‰ä½ç½®ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚å¯¹äºnoisy gradient,æˆ‘ä»¬éœ€è¦è°¨æ…çš„é€‰å–å­¦ä¹ ç‡å’Œbatch size, æ¥æ§åˆ¶æ¢¯åº¦æ–¹å·®å’Œæ”¶æ•›çš„ç»“æœã€‚</p>
<script type="math/tex; mode=display">
\mathbf{g}_t = \partial_{\mathbf{w}} \frac{1}{|\mathcal{B}_t|} \sum_{i \in \mathcal{B}_t} f(\mathbf{x}_{i}, \mathbf{w}_{t-1}) = \frac{1}{|\mathcal{B}_t|} \sum_{i \in \mathcal{B}_t} \mathbf{g}_{i, t-1}.</script><h3 id="ill-condition"><a href="#ill-condition" class="headerlink" title="ill-condition"></a>ill-condition</h3><p>Condition Number of Hessian Matrix:</p>
<script type="math/tex; mode=display">
 cond_{H} = \frac{\lambda_{max}}{\lambda_{min}}</script><p>where $\lambda_{max}, \lambda_{min}$ is the maximum amd minimum eignvalue of Hessian matrix.</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªè¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«ä¸ºäºŒç»´å‘é‡$\boldsymbol{x} = [x_1, x_2]^\top$å’Œæ ‡é‡çš„ç›®æ ‡å‡½æ•°:</p>
<script type="math/tex; mode=display">
 f(\boldsymbol{x})=0.1x_1^2+2x_2^2</script><script type="math/tex; mode=display">
cond_{H} = \frac{4}{0.2} = 20 \quad \rightarrow \quad \text{ill-conditioned}</script><p>å¯¹äºill-condition ï¼Œ å…¶ä¸»è¦é—®é¢˜åœ¨äºåœ¨ä¸åŒçš„ç»´åº¦ä¸Šï¼Œæ‰€æœŸæœ›å¾—åˆ°çš„åˆé€‚çš„lræ˜¯ä¸åŒçš„ï¼Œå› æ­¤ï¼Œè€ƒè™‘å°†å…¶æ”¾ç¼©åˆ°ç›¸è¿‘çš„å¤§å°ä¸Šï¼š</p>
<p>åœ¨äºŒé˜¶ä¼˜åŒ–ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Hessian matrixçš„é€†çŸ©é˜µ(æˆ–è€…pseudo inverse)æ¥å·¦ä¹˜æ¢¯åº¦å‘é‡ $i.e. \Delta_{x} = H^{-1}\mathbf{g}$ï¼Œè¿™æ ·çš„åšæ³•ç§°ä¸ºpreconditionï¼Œç›¸å½“äºå°† $H$ æ˜ å°„ä¸ºä¸€ä¸ªå•ä½çŸ©é˜µï¼Œæ‹¥æœ‰åˆ†å¸ƒå‡åŒ€çš„Spectrumï¼Œä¹Ÿå³æˆ‘ä»¬å»ä¼˜åŒ–çš„ç­‰ä»·æ ‡å‡½æ•°çš„Hessian matrixä¸ºè‰¯å¥½çš„identity matrixã€‚</p>
<ul>
<li><strong>Preconditioning gradient vector</strong>: applied in Adam, RMSProp, AdaGrad, Adelta, KFC, Natural gradient and other secord-order optimization algorithms.</li>
<li><strong>Averaging history gradient</strong>: like momentum, which allows larger learning rates to accelerate convergence; applied in Adam, RMSProp, SGD momentum.  </li>
</ul>
<h3 id="Momentum-Algorithm"><a href="#Momentum-Algorithm" class="headerlink" title="Momentum Algorithm"></a>Momentum Algorithm</h3><p>åŠ¨é‡æ³•çš„æå‡ºæ˜¯ä¸ºäº†è§£å†³æ¢¯åº¦ä¸‹é™çš„ä¸Šè¿°é—®é¢˜ã€‚è®¾æ—¶é—´æ­¥ $t$ çš„è‡ªå˜é‡ä¸º $\boldsymbol{x}_t$ï¼Œå­¦ä¹ ç‡ä¸º $\eta_t$ã€‚<br>åœ¨æ—¶é—´æ­¥ $t=0$ï¼ŒåŠ¨é‡æ³•åˆ›å»ºé€Ÿåº¦å˜é‡ $\boldsymbol{m}_0$ï¼Œå¹¶å°†å…¶å…ƒç´ åˆå§‹åŒ–æˆ 0ã€‚åœ¨æ—¶é—´æ­¥ $t&gt;0$ï¼ŒåŠ¨é‡æ³•å¯¹æ¯æ¬¡è¿­ä»£çš„æ­¥éª¤åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{m}_t &\leftarrow \beta \boldsymbol{m}_{t-1} + \eta_t \boldsymbol{g}_t, \\
\boldsymbol{x}_t &\leftarrow \boldsymbol{x}_{t-1} - \boldsymbol{m}_t,
\end{aligned}</script><p>Another version:</p>
<script type="math/tex; mode=display">
\begin{aligned}
\boldsymbol{m}_t &\leftarrow \beta \boldsymbol{m}_{t-1} + (1-\beta) \boldsymbol{g}_t, \\
\boldsymbol{x}_t &\leftarrow \boldsymbol{x}_{t-1} - \alpha_t \boldsymbol{m}_t,
\end{aligned}</script><script type="math/tex; mode=display">
\alpha_t = \frac{\eta_t}{1-\beta}</script><p>å…¶ä¸­ï¼ŒåŠ¨é‡è¶…å‚æ•° $\beta$æ»¡è¶³ $0 \leq \beta &lt; 1$ã€‚å½“ $\beta=0$ æ—¶ï¼ŒåŠ¨é‡æ³•ç­‰ä»·äºå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€‚</p>
<p>åœ¨è§£é‡ŠåŠ¨é‡æ³•çš„æ•°å­¦åŸç†å‰ï¼Œè®©æˆ‘ä»¬å…ˆä»å®éªŒä¸­è§‚å¯Ÿæ¢¯åº¦ä¸‹é™åœ¨ä½¿ç”¨åŠ¨é‡æ³•åçš„è¿­ä»£è½¨è¿¹ã€‚</p>
<p>å¯¹äºåŠ¨é‡ç®—æ³•ï¼Œå…¶ä¸»è¦è€ƒè™‘äº†å½“å‰æ¢¯åº¦ä¸‹é™æ–¹å‘å‰çš„å†å²è®°å½•å¯¹äºå…¶çš„å½±å“ï¼Œä½¿å¾—å…¶èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹é¿å…åˆ°ill-conditioné—®é¢˜ã€‚</p>
<p>å¯ä»¥é€šè¿‡ç§»åŠ¨åŠ æƒå¹³å‡çš„æ–¹å¼æ¥è€ƒå¯Ÿç†è§£åŠ¨é‡æ³•ã€‚</p>
<h3 id="AdaGrad"><a href="#AdaGrad" class="headerlink" title="AdaGrad"></a>AdaGrad</h3><p>å…¶å®è´¨ä¸Šæ˜¯åˆ©ç”¨è€ƒè™‘Hessian matrixçš„æ–¹å¼æ¥ä½¿å¾—ä¹‹å‰çš„é—®é¢˜å¾—åˆ°å¤„ç†</p>
<h4 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h4><p>AdaGradç®—æ³•ä¼šä½¿ç”¨ä¸€ä¸ªå°æ‰¹é‡éšæœºæ¢¯åº¦$\boldsymbol{g}_t$æŒ‰å…ƒç´ å¹³æ–¹çš„ç´¯åŠ å˜é‡$\boldsymbol{s}_t$ã€‚åœ¨æ—¶é—´æ­¥0ï¼ŒAdaGradå°†$\boldsymbol{s}_0$ä¸­æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º0ã€‚åœ¨æ—¶é—´æ­¥$t$ï¼Œé¦–å…ˆå°†å°æ‰¹é‡éšæœºæ¢¯åº¦$\boldsymbol{g}_t$æŒ‰å…ƒç´ å¹³æ–¹åç´¯åŠ åˆ°å˜é‡$\boldsymbol{s}_t$ï¼š</p>
<script type="math/tex; mode=display">
\boldsymbol{s}_t \leftarrow \boldsymbol{s}_{t-1} + \boldsymbol{g}_t \odot \boldsymbol{g}_t,</script><p>å…¶ä¸­$\odot$æ˜¯æŒ‰å…ƒç´ ç›¸ä¹˜ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ è¿ç®—é‡æ–°è°ƒæ•´ä¸€ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
\boldsymbol{x}_t \leftarrow \boldsymbol{x}_{t-1} - \frac{\eta}{\sqrt{\boldsymbol{s}_t + \epsilon}} \odot \boldsymbol{g}_t,</script><p>å…¶ä¸­$\eta$æ˜¯å­¦ä¹ ç‡ï¼Œ$\epsilon$æ˜¯ä¸ºäº†ç»´æŒæ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå¦‚$10^{-6}$ã€‚è¿™é‡Œå¼€æ–¹ã€é™¤æ³•å’Œä¹˜æ³•çš„è¿ç®—éƒ½æ˜¯æŒ‰å…ƒç´ è¿ç®—çš„ã€‚è¿™äº›æŒ‰å…ƒç´ è¿ç®—ä½¿å¾—ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ éƒ½åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å­¦ä¹ ç‡ã€‚</p>
<p>å…¶é—®é¢˜åœ¨äºä¸‹é™çš„åæœŸå¯èƒ½ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±</p>
<h2 id="word2vec"><a href="#word2vec" class="headerlink" title="word2vec"></a>word2vec</h2><p>Word2Vec è¯åµŒå…¥å·¥å…·çš„æå‡ºæ­£æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå°†æ¯ä¸ªè¯è¡¨ç¤ºæˆä¸€ä¸ªå®šé•¿çš„å‘é‡ï¼Œå¹¶é€šè¿‡åœ¨è¯­æ–™åº“ä¸Šçš„é¢„è®­ç»ƒä½¿å¾—è¿™äº›å‘é‡èƒ½è¾ƒå¥½åœ°è¡¨è¾¾ä¸åŒè¯ä¹‹é—´çš„ç›¸ä¼¼å’Œç±»æ¯”å…³ç³»ï¼Œä»¥å¼•å…¥ä¸€å®šçš„è¯­ä¹‰ä¿¡æ¯ã€‚åŸºäºä¸¤ç§æ¦‚ç‡æ¨¡å‹çš„å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ç§ Word2Vec æ¨¡å‹ï¼š</p>
<ol>
<li><a href="https://zh.d2l.ai/chapter_natural-language-processing/word2vec.html#%E8%B7%B3%E5%AD%97%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">Skip-Gram è·³å­—æ¨¡å‹</a>ï¼šå‡è®¾èƒŒæ™¯è¯ç”±ä¸­å¿ƒè¯ç”Ÿæˆï¼Œå³å»ºæ¨¡ $P(w_o\mid w_c)$ï¼Œå…¶ä¸­ $w_c$ ä¸ºä¸­å¿ƒè¯ï¼Œ$w_o$ ä¸ºä»»ä¸€èƒŒæ™¯è¯ï¼›</li>
</ol>
<p><img src="https://cdn.kesci.com/upload/image/q5mjsq84o9.png?imageView2/0/w/960/h/960" alt="Image Name"></p>
<ol>
<li><a href="https://zh.d2l.ai/chapter_natural-language-processing/word2vec.html#%E8%BF%9E%E7%BB%AD%E8%AF%8D%E8%A2%8B%E6%A8%A1%E5%9E%8B" target="_blank" rel="noopener">CBOW (continuous bag-of-words) è¿ç»­è¯è¢‹æ¨¡å‹</a>ï¼šå‡è®¾ä¸­å¿ƒè¯ç”±èƒŒæ™¯è¯ç”Ÿæˆï¼Œå³å»ºæ¨¡ $P(w_c\mid \mathcal{W}_o)$ï¼Œå…¶ä¸­ $\mathcal{W}_o$ ä¸ºèƒŒæ™¯è¯çš„é›†åˆã€‚</li>
</ol>
<p><img src="https://cdn.kesci.com/upload/image/q5mjt4r02n.png?imageView2/0/w/960/h/960" alt="Image Name"></p>
<h4 id="äºŒæ¬¡é‡‡æ ·"><a href="#äºŒæ¬¡é‡‡æ ·" class="headerlink" title="äºŒæ¬¡é‡‡æ ·"></a>äºŒæ¬¡é‡‡æ ·</h4><p>å¯¹äºæŸäº›é«˜é¢‘è¯ï¼Œå…¶å®é™…ä¸Šçš„æ„ä¹‰æ˜¯ä¸å¤§çš„ï¼Œå› æ­¤éœ€è¦è€ƒè™‘ä¸¢å¼ƒè¿™äº›é«˜é¢‘è¯ã€‚é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼è¿›è¡ŒäºŒæ¬¡é‡‡æ ·ï¼š</p>
<script type="math/tex; mode=display">
P(w_i)=\max(1-\sqrt{\frac{t}{f(w_i)}},0)</script><p>å…¶ä¸­  $f(w_i)$  æ˜¯æ•°æ®é›†ä¸­è¯ $w_i$ çš„ä¸ªæ•°ä¸æ€»è¯æ•°ä¹‹æ¯”ï¼Œå¸¸æ•° $t$ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼ˆå®éªŒä¸­è®¾ä¸º $10^{âˆ’4}$ï¼‰ã€‚å¯è§ï¼Œåªæœ‰å½“ $f(w_i)&gt;t$ æ—¶ï¼Œæˆ‘ä»¬æ‰æœ‰å¯èƒ½åœ¨äºŒæ¬¡é‡‡æ ·ä¸­ä¸¢å¼ƒè¯ $w_i$ï¼Œå¹¶ä¸”è¶Šé«˜é¢‘çš„è¯è¢«ä¸¢å¼ƒçš„æ¦‚ç‡è¶Šå¤§ã€‚</p>
<h3 id="Skip-Gram-è·³å­—æ¨¡å‹"><a href="#Skip-Gram-è·³å­—æ¨¡å‹" class="headerlink" title="Skip-Gram è·³å­—æ¨¡å‹"></a>Skip-Gram è·³å­—æ¨¡å‹</h3><p>åœ¨è·³å­—æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¯è¢«è¡¨ç¤ºæˆä¸¤ä¸ª $d$ ç»´å‘é‡ï¼Œç”¨æ¥è®¡ç®—æ¡ä»¶æ¦‚ç‡ã€‚å‡è®¾è¿™ä¸ªè¯åœ¨è¯å…¸ä¸­ç´¢å¼•ä¸º $i$ ï¼Œå½“å®ƒä¸ºä¸­å¿ƒè¯æ—¶å‘é‡è¡¨ç¤ºä¸º $\boldsymbol{v}_i\in\mathbb{R}^d$ï¼Œè€Œä¸ºèƒŒæ™¯è¯æ—¶å‘é‡è¡¨ç¤ºä¸º $\boldsymbol{u}_i\in\mathbb{R}^d$ ã€‚è®¾ä¸­å¿ƒè¯ $w_c$ åœ¨è¯å…¸ä¸­ç´¢å¼•ä¸º $c$ï¼ŒèƒŒæ™¯è¯ $w_o$ åœ¨è¯å…¸ä¸­ç´¢å¼•ä¸º $o$ï¼Œæˆ‘ä»¬å‡è®¾ç»™å®šä¸­å¿ƒè¯ç”ŸæˆèƒŒæ™¯è¯çš„æ¡ä»¶æ¦‚ç‡æ»¡è¶³ä¸‹å¼ï¼š</p>
<script type="math/tex; mode=display">
P(w_o\mid w_c)=\frac{\exp(\boldsymbol{u}_o^\top \boldsymbol{v}_c)}{\sum_{i\in\mathcal{V}}\exp(\boldsymbol{u}_i^\top \boldsymbol{v}_c)}</script><p>ç”±äºè¯é‡è¾ƒå¤§ï¼Œå› æ­¤éœ€è¦è€ƒè™‘é‡‡ç”¨è´Ÿé‡‡æ ·çš„æ–¹å¼æ¥è§£å†³æ­¤é—®é¢˜ï¼š</p>
<p>è´Ÿé‡‡æ ·æ–¹æ³•ç”¨ä»¥ä¸‹å…¬å¼æ¥è¿‘ä¼¼æ¡ä»¶æ¦‚ç‡ $P(w_o\mid w_c)=\frac{\exp(\boldsymbol{u}_o^\top \boldsymbol{v}_c)}{\sum_{i\in\mathcal{V}}\exp(\boldsymbol{u}_i^\top \boldsymbol{v}_c)}$ï¼š</p>
<script type="math/tex; mode=display">
P(w_o\mid w_c)=P(D=1\mid w_c,w_o)\prod_{k=1,w_k\sim P(w)}^K P(D=0\mid w_c,w_k)</script><p>å…¶ä¸­ $P(D=1\mid w_c,w_o)=\sigma(\boldsymbol{u}_o^\top\boldsymbol{v}_c)$ï¼Œ$\sigma(\cdot)$ ä¸º sigmoid å‡½æ•°ã€‚å¯¹äºä¸€å¯¹ä¸­å¿ƒè¯å’ŒèƒŒæ™¯è¯ï¼Œæˆ‘ä»¬ä»è¯å…¸ä¸­éšæœºé‡‡æ · $K$ ä¸ªå™ªå£°è¯ï¼ˆå®éªŒä¸­è®¾ $K=5$ï¼‰ã€‚æ ¹æ® Word2Vec è®ºæ–‡çš„å»ºè®®ï¼Œå™ªå£°è¯é‡‡æ ·æ¦‚ç‡ $P(w)$ è®¾ä¸º $w$ è¯é¢‘ä¸æ€»è¯é¢‘ä¹‹æ¯”çš„ $0.75$ æ¬¡æ–¹ã€‚</p>
<h2 id="ç›®æ ‡æ£€æµ‹"><a href="#ç›®æ ‡æ£€æµ‹" class="headerlink" title="ç›®æ ‡æ£€æµ‹"></a>ç›®æ ‡æ£€æµ‹</h2><p>ç›®æ ‡æ£€æµ‹ç®—æ³•é€šå¸¸ä¼šåœ¨è¾“å…¥å›¾åƒä¸­é‡‡æ ·å¤§é‡çš„åŒºåŸŸï¼Œç„¶ååˆ¤æ–­è¿™äº›åŒºåŸŸä¸­æ˜¯å¦åŒ…å«æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç›®æ ‡ï¼Œå¹¶è°ƒæ•´åŒºåŸŸè¾¹ç¼˜ä»è€Œæ›´å‡†ç¡®åœ°é¢„æµ‹ç›®æ ‡çš„çœŸå®è¾¹ç•Œæ¡†ï¼ˆground-truth bounding boxï¼‰ã€‚ä¸åŒçš„æ¨¡å‹ä½¿ç”¨çš„åŒºåŸŸé‡‡æ ·æ–¹æ³•å¯èƒ½ä¸åŒã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç»å…¶ä¸­çš„ä¸€ç§æ–¹æ³•ï¼šå®ƒä»¥æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒç”Ÿæˆå¤šä¸ªå¤§å°å’Œå®½é«˜æ¯”ï¼ˆaspect ratioï¼‰ä¸åŒçš„è¾¹ç•Œæ¡†ã€‚è¿™äº›è¾¹ç•Œæ¡†è¢«ç§°ä¸ºé”šæ¡†ï¼ˆanchor boxï¼‰ã€‚æˆ‘ä»¬å°†åœ¨åé¢åŸºäºé”šæ¡†å®è·µç›®æ ‡æ£€æµ‹ã€‚</p>
<p>å‡è®¾è¾“å…¥å›¾åƒé«˜ä¸º $h$ï¼Œå®½ä¸º$w$ã€‚æˆ‘ä»¬åˆ†åˆ«ä»¥å›¾åƒçš„æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒç”Ÿæˆä¸åŒå½¢çŠ¶çš„é”šæ¡†ã€‚è®¾å¤§å°ä¸º$s\in (0,1]$ä¸”å®½é«˜æ¯”ä¸º$r &gt; 0$ï¼Œé‚£ä¹ˆé”šæ¡†çš„å®½å’Œé«˜å°†åˆ†åˆ«ä¸º$ws\sqrt{r}$å’Œ$hs/\sqrt{r}$ã€‚å½“ä¸­å¿ƒä½ç½®ç»™å®šæ—¶ï¼Œå·²çŸ¥å®½å’Œé«˜çš„é”šæ¡†æ˜¯ç¡®å®šçš„ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è®¾å®šå¥½ä¸€ç»„å¤§å°$s_1,\ldots,s_n$å’Œä¸€ç»„å®½é«˜æ¯”$r_1,\ldots,r_m$ã€‚å¦‚æœä»¥æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒæ—¶ä½¿ç”¨æ‰€æœ‰çš„å¤§å°ä¸å®½é«˜æ¯”çš„ç»„åˆï¼Œè¾“å…¥å›¾åƒå°†ä¸€å…±å¾—åˆ°$whnm$ä¸ªé”šæ¡†ã€‚è™½ç„¶è¿™äº›é”šæ¡†å¯èƒ½è¦†ç›–äº†æ‰€æœ‰çš„çœŸå®è¾¹ç•Œæ¡†ï¼Œä½†è®¡ç®—å¤æ‚åº¦å®¹æ˜“è¿‡é«˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸åªå¯¹åŒ…å«$s_1$æˆ–$r_1$çš„å¤§å°ä¸å®½é«˜æ¯”çš„ç»„åˆæ„Ÿå…´è¶£ï¼Œå³</p>
<script type="math/tex; mode=display">
(s_1, r_1), (s_1, r_2), \ldots, (s_1, r_m), (s_2, r_1), (s_3, r_1), \ldots, (s_n, r_1).</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ç›¸åŒåƒç´ ä¸ºä¸­å¿ƒçš„é”šæ¡†çš„æ•°é‡ä¸º$n+m-1$ã€‚å¯¹äºæ•´ä¸ªè¾“å…¥å›¾åƒï¼Œæˆ‘ä»¬å°†ä¸€å…±ç”Ÿæˆ$wh(n+m-1)$ä¸ªé”šæ¡†ã€‚</p>
<h3 id="äº¤å¹¶æ¯”"><a href="#äº¤å¹¶æ¯”" class="headerlink" title="äº¤å¹¶æ¯”"></a>äº¤å¹¶æ¯”</h3><p>æˆ‘ä»¬åˆšåˆšæåˆ°æŸä¸ªé”šæ¡†è¾ƒå¥½åœ°è¦†ç›–äº†å›¾åƒä¸­çš„ç‹—ã€‚å¦‚æœè¯¥ç›®æ ‡çš„çœŸå®è¾¹ç•Œæ¡†å·²çŸ¥ï¼Œè¿™é‡Œçš„â€œè¾ƒå¥½â€è¯¥å¦‚ä½•é‡åŒ–å‘¢ï¼Ÿä¸€ç§ç›´è§‚çš„æ–¹æ³•æ˜¯è¡¡é‡é”šæ¡†å’ŒçœŸå®è¾¹ç•Œæ¡†ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒJaccardç³»æ•°ï¼ˆJaccard indexï¼‰å¯ä»¥è¡¡é‡ä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼åº¦ã€‚ç»™å®šé›†åˆ$\mathcal{A}$å’Œ$\mathcal{B}$ï¼Œå®ƒä»¬çš„Jaccardç³»æ•°å³äºŒè€…äº¤é›†å¤§å°é™¤ä»¥äºŒè€…å¹¶é›†å¤§å°ï¼š</p>
<script type="math/tex; mode=display">
J(\mathcal{A},\mathcal{B}) = \frac{\left|\mathcal{A} \cap \mathcal{B}\right|}{\left| \mathcal{A} \cup \mathcal{B}\right|}.</script><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¾¹ç•Œæ¡†å†…çš„åƒç´ åŒºåŸŸçœ‹æˆæ˜¯åƒç´ çš„é›†åˆã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„åƒç´ é›†åˆçš„Jaccardç³»æ•°è¡¡é‡è¿™ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„ç›¸ä¼¼åº¦ã€‚å½“è¡¡é‡ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„ç›¸ä¼¼åº¦æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å°†Jaccardç³»æ•°ç§°ä¸ºäº¤å¹¶æ¯”ï¼ˆIntersection over Unionï¼ŒIoUï¼‰ï¼Œå³ä¸¤ä¸ªè¾¹ç•Œæ¡†ç›¸äº¤é¢ç§¯ä¸ç›¸å¹¶é¢ç§¯ä¹‹æ¯”ï¼Œå¦‚å›¾9.2æ‰€ç¤ºã€‚äº¤å¹¶æ¯”çš„å–å€¼èŒƒå›´åœ¨0å’Œ1ä¹‹é—´ï¼š0è¡¨ç¤ºä¸¤ä¸ªè¾¹ç•Œæ¡†æ— é‡åˆåƒç´ ï¼Œ1è¡¨ç¤ºä¸¤ä¸ªè¾¹ç•Œæ¡†ç›¸ç­‰ã€‚</p>
<p><img src="https://cdn.kesci.com/upload/image/q5vs9jkw9f.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<p>åœ¨æ¨¡å‹é¢„æµ‹é˜¶æ®µï¼Œæˆ‘ä»¬å…ˆä¸ºå›¾åƒç”Ÿæˆå¤šä¸ªé”šæ¡†ï¼Œå¹¶ä¸ºè¿™äº›é”šæ¡†ä¸€ä¸€é¢„æµ‹ç±»åˆ«å’Œåç§»é‡ã€‚éšåï¼Œæˆ‘ä»¬æ ¹æ®é”šæ¡†åŠå…¶é¢„æµ‹åç§»é‡å¾—åˆ°é¢„æµ‹è¾¹ç•Œæ¡†ã€‚å½“é”šæ¡†æ•°é‡è¾ƒå¤šæ—¶ï¼ŒåŒä¸€ä¸ªç›®æ ‡ä¸Šå¯èƒ½ä¼šè¾“å‡ºè¾ƒå¤šç›¸ä¼¼çš„é¢„æµ‹è¾¹ç•Œæ¡†ã€‚ä¸ºäº†ä½¿ç»“æœæ›´åŠ ç®€æ´ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤ç›¸ä¼¼çš„é¢„æµ‹è¾¹ç•Œæ¡†ã€‚å¸¸ç”¨çš„æ–¹æ³•å«ä½œéæå¤§å€¼æŠ‘åˆ¶ï¼ˆnon-maximum suppressionï¼ŒNMSï¼‰ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2020/02/16/pytorch2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/16/pytorch2/" itemprop="url">pytorch2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-16T19:59:51+08:00">
                2020-02-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ -task2"><a href="#åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ -task2" class="headerlink" title="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  task2"></a>åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  task2</h1><hr>
<h2 id="æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸"><a href="#æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸"></a>æ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸</h2><h2 id="æœºå™¨ç¿»è¯‘åŠç›¸å…³æŠ€æœ¯"><a href="#æœºå™¨ç¿»è¯‘åŠç›¸å…³æŠ€æœ¯" class="headerlink" title="æœºå™¨ç¿»è¯‘åŠç›¸å…³æŠ€æœ¯"></a>æœºå™¨ç¿»è¯‘åŠç›¸å…³æŠ€æœ¯</h2><p>æœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ï¼šå°†ä¸€æ®µæ–‡æœ¬ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘ä¸ºå¦ä¸€ç§è¯­è¨€ï¼Œç”¨ç¥ç»ç½‘ç»œè§£å†³è¿™ä¸ªé—®é¢˜é€šå¸¸ç§°ä¸ºç¥ç»æœºå™¨ç¿»è¯‘ï¼ˆNMTï¼‰ã€‚ ä¸»è¦ç‰¹å¾ï¼šè¾“å‡ºæ˜¯å•è¯åºåˆ—è€Œä¸æ˜¯å•ä¸ªå•è¯ã€‚ è¾“å‡ºåºåˆ—çš„é•¿åº¦å¯èƒ½ä¸æºåºåˆ—çš„é•¿åº¦ä¸åŒã€‚</p>
<h3 id="æ•°æ®é¢„å¤„ç†è¿‡ç¨‹"><a href="#æ•°æ®é¢„å¤„ç†è¿‡ç¨‹" class="headerlink" title="æ•°æ®é¢„å¤„ç†è¿‡ç¨‹"></a>æ•°æ®é¢„å¤„ç†è¿‡ç¨‹</h3><p>å¯¹äºä¸€èˆ¬çš„æ•°æ®é¢„å¤„ç†è¿‡ç¨‹ï¼Œé¦–å…ˆè¦ä¿è¯ç¼–ç æ–¹å¼çš„æ­£ç¡®ã€‚ç„¶åéœ€è¦è½¬æ¢å¤§å°å†™ï¼Œè¿™é‡Œæ²¡æœ‰è®¸å¤šå¤šä½™çš„å¤„ç†æ“ä½œã€‚</p>
<h4 id="è½½å…¥æ•°æ®é›†"><a href="#è½½å…¥æ•°æ®é›†" class="headerlink" title="è½½å…¥æ•°æ®é›†"></a>è½½å…¥æ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(line, max_len, padding_token)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(line) &gt; max_len:</span><br><span class="line">        <span class="keyword">return</span> line[:max_len]</span><br><span class="line">    <span class="keyword">return</span> line + [padding_token] * (max_len - len(line))</span><br><span class="line">pad(src_vocab[source[<span class="number">0</span>]], <span class="number">10</span>, src_vocab.pad)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªpad å‡½æ•°çš„ä½œç”¨åœ¨äºä¿æŒæ¯ä¸ªå¥å­çš„é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ˜¯å¤§äºçš„è¯ï¼Œé‚£ä¹ˆå°±è¿›è¡Œé˜¶æ®µï¼Œå¦åˆ™è¿›è¡Œç›¸åº”çš„è¡¥è¶³ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_array</span><span class="params">(lines, vocab, max_len, is_source)</span>:</span></span><br><span class="line">    lines = [vocab[line] <span class="keyword">for</span> line <span class="keyword">in</span> lines]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_source:</span><br><span class="line">        lines = [[vocab.bos] + line + [vocab.eos] <span class="keyword">for</span> line <span class="keyword">in</span> lines]</span><br><span class="line">    array = torch.tensor([pad(line, max_len, vocab.pad) <span class="keyword">for</span> line <span class="keyword">in</span> lines])</span><br><span class="line">    valid_len = (array != vocab.pad).sum(<span class="number">1</span>) <span class="comment">#ç¬¬ä¸€ä¸ªç»´åº¦</span></span><br><span class="line">    <span class="keyword">return</span> array, valid_len</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œå…³äºæœ‰æ•ˆé•¿åº¦çš„è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—éè¡¥è¶³çš„é•¿åº¦ã€‚</p>
<h3 id="Encoder-Decoder"><a href="#Encoder-Decoder" class="headerlink" title="Encoder-Decoder"></a>Encoder-Decoder</h3><p>å…¶ç»“æ„æ˜¯å¦‚æ­¤è¡¨ç¤ºçš„ï¼Œå³æ‰€æœ‰çš„å¯èƒ½æ˜¯ä»¥è¿™æ ·ä¸€ç§æ–¹å¼æ˜¾ç°å‡ºæ¥</p>
<p><img src="https://cdn.kesci.com/upload/image/q5jcat3c8m.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<p>å› ä¸ºæœ¬èº«çš„RNNçš„ç½‘ç»œç»“æ„ä¸èƒ½ä¿æŒå…·ä½“çš„ç¿»è¯‘è¿‡ç¨‹ä¸­é•¿åº¦çš„å˜åŒ–ï¼Œé‚£ä¹ˆè¦è¾¾åˆ°è¿™æ ·çš„ç›®æ ‡ï¼Œä½¿ç”¨äº†è¿™æ ·ä¸€ç§æ–¹å¼ï¼Œå³é¦–å…ˆå¯¹è¾“å…¥è¿›è¡Œäº†ç¼–ç ï¼Œç„¶åè¿›è¡Œè§£ç åè¾“å‡ºã€‚</p>
<h4 id="Sequence-to-Sequence-æ¨¡å‹"><a href="#Sequence-to-Sequence-æ¨¡å‹" class="headerlink" title="Sequence to Sequence æ¨¡å‹"></a>Sequence to Sequence æ¨¡å‹</h4><p><img src="https://cdn.kesci.com/upload/image/q5jc7a53pt.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<p><img src="https://cdn.kesci.com/upload/image/q5jccjhkii.png?imageView2/0/w/500/h/500" alt="Image Name"></p>
<p>è¿™é‡Œè¿›è¡Œäº†ç›¸åº”çš„embeddingï¼Œæ˜¯å°†ç›¸åº”çš„è¾“å…¥è½¬æ¢ä¸ºè¯å‘é‡æ¥ä½œä¸ºç›¸åº”çš„è¾“å…¥ã€‚è¯å‘é‡çš„é•¿åº¦æ˜¯ç›¸åŒçš„ç»´åº¦ã€‚</p>
<h4 id="è®­ç»ƒæ¨¡å‹å’Œæµ‹è¯•æ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹å’Œæµ‹è¯•æ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹å’Œæµ‹è¯•æ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹å’Œæµ‹è¯•æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_ch7</span><span class="params">(model, data_iter, lr, num_epochs, device)</span>:</span>  <span class="comment"># Saved in d2l</span></span><br><span class="line">    model.to(device)</span><br><span class="line">    optimizer = optim.Adam(model.parameters(), lr=lr)</span><br><span class="line">    loss = MaskedSoftmaxCELoss()</span><br><span class="line">    tic = time.time()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">1</span>, num_epochs+<span class="number">1</span>):</span><br><span class="line">        l_sum, num_tokens_sum = <span class="number">0.0</span>, <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> batch <span class="keyword">in</span> data_iter:</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            X, X_vlen, Y, Y_vlen = [x.to(device) <span class="keyword">for</span> x <span class="keyword">in</span> batch]</span><br><span class="line">            Y_input, Y_label, Y_vlen = Y[:,:<span class="number">-1</span>], Y[:,<span class="number">1</span>:], Y_vlen<span class="number">-1</span></span><br><span class="line">            </span><br><span class="line">            Y_hat, _ = model(X, Y_input, X_vlen, Y_vlen)</span><br><span class="line">            l = loss(Y_hat, Y_label, Y_vlen).sum()</span><br><span class="line">            l.backward()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                d2l.grad_clipping_nn(model, <span class="number">5</span>, device)</span><br><span class="line">            num_tokens = Y_vlen.sum().item()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            l_sum += l.sum().item()</span><br><span class="line">            num_tokens_sum += num_tokens</span><br><span class="line">        <span class="keyword">if</span> epoch % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"epoch &#123;0:4d&#125;,loss &#123;1:.3f&#125;, time &#123;2:.1f&#125; sec"</span>.format( </span><br><span class="line">                  epoch, (l_sum/num_tokens_sum), time.time()-tic))</span><br><span class="line">            tic = time.time()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">translate_ch7</span><span class="params">(model, src_sentence, src_vocab, tgt_vocab, max_len, device)</span>:</span></span><br><span class="line">    src_tokens = src_vocab[src_sentence.lower().split(<span class="string">' '</span>)]</span><br><span class="line">    src_len = len(src_tokens)</span><br><span class="line">    <span class="keyword">if</span> src_len &lt; max_len:</span><br><span class="line">        src_tokens += [src_vocab.pad] * (max_len - src_len)</span><br><span class="line">    enc_X = torch.tensor(src_tokens, device=device)</span><br><span class="line">    enc_valid_length = torch.tensor([src_len], device=device)</span><br><span class="line">    <span class="comment"># use expand_dim to add the batch_size dimension.</span></span><br><span class="line">    enc_outputs = model.encoder(enc_X.unsqueeze(dim=<span class="number">0</span>), enc_valid_length)</span><br><span class="line">    dec_state = model.decoder.init_state(enc_outputs, enc_valid_length)</span><br><span class="line">    dec_X = torch.tensor([tgt_vocab.bos], device=device).unsqueeze(dim=<span class="number">0</span>)</span><br><span class="line">    predict_tokens = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(max_len):</span><br><span class="line">        Y, dec_state = model.decoder(dec_X, dec_state)</span><br><span class="line">        <span class="comment"># The token with highest score is used as the next time step input.</span></span><br><span class="line">        dec_X = Y.argmax(dim=<span class="number">2</span>)</span><br><span class="line">        py = dec_X.squeeze(dim=<span class="number">0</span>).int().item()</span><br><span class="line">        <span class="keyword">if</span> py == tgt_vocab.eos:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        predict_tokens.append(py)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">' '</span>.join(tgt_vocab.to_tokens(predict_tokens))</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨æ„åŠ›æœºåˆ¶"><a href="#æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="æ³¨æ„åŠ›æœºåˆ¶"></a>æ³¨æ„åŠ›æœºåˆ¶</h2><p><img src="https://cdn.kesci.com/upload/image/q5km4dwgf9.PNG?imageView2/0/w/960/h/960" alt="Image Name"></p>
<p>Attention æ˜¯ä¸€ç§é€šç”¨çš„å¸¦æƒæ± åŒ–æ–¹æ³•ï¼Œè¾“å…¥ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼šè¯¢é—®ï¼ˆqueryï¼‰å’Œé”®å€¼å¯¹ï¼ˆkey-value pairsï¼‰ã€‚$ğ¤_ğ‘–âˆˆâ„^{ğ‘‘_ğ‘˜}, ğ¯_ğ‘–âˆˆâ„^{ğ‘‘_ğ‘£}$. Query  $ğªâˆˆâ„^{ğ‘‘_ğ‘}$ , attention layerå¾—åˆ°è¾“å‡ºä¸valueçš„ç»´åº¦ä¸€è‡´ $ğ¨âˆˆâ„^{ğ‘‘_ğ‘£}$. å¯¹äºä¸€ä¸ªqueryæ¥è¯´ï¼Œattention layer ä¼šä¸æ¯ä¸€ä¸ªkeyè®¡ç®—æ³¨æ„åŠ›åˆ†æ•°å¹¶è¿›è¡Œæƒé‡çš„å½’ä¸€åŒ–ï¼Œè¾“å‡ºçš„å‘é‡$o$åˆ™æ˜¯valueçš„åŠ æƒæ±‚å’Œï¼Œè€Œæ¯ä¸ªkeyè®¡ç®—çš„æƒé‡ä¸valueä¸€ä¸€å¯¹åº”ã€‚</p>
<p>ä¸ºäº†è®¡ç®—è¾“å‡ºï¼Œæˆ‘ä»¬é¦–å…ˆå‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°$\alpha$ ç”¨äºè®¡ç®—queryå’Œkeyçš„ç›¸ä¼¼æ€§ï¼Œç„¶åå¯ä»¥è®¡ç®—æ‰€æœ‰çš„ attention scores $a_1, \ldots, a_n$ by</p>
<script type="math/tex; mode=display">
a_i = \alpha(\mathbf q, \mathbf k_i).</script><p>æˆ‘ä»¬ä½¿ç”¨<code>softmax</code>å‡½æ•° è·å¾—æ³¨æ„åŠ›æƒé‡ï¼š</p>
<script type="math/tex; mode=display">
b_1, \ldots, b_n = \textrm{softmax}(a_1, \ldots, a_n).</script><p>æœ€ç»ˆçš„è¾“å‡ºå°±æ˜¯valueçš„åŠ æƒæ±‚å’Œï¼š</p>
<script type="math/tex; mode=display">
\mathbf o = \sum_{i=1}^n b_i \mathbf v_i.</script><h3 id="softmax-å±è”½"><a href="#softmax-å±è”½" class="headerlink" title="softmax å±è”½"></a>softmax å±è”½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">masked_softmax</span><span class="params">(X, valid_length)</span>:</span></span><br><span class="line">    <span class="comment"># X: 3-D tensor, valid_length: 1-D or 2-D tensor</span></span><br><span class="line">    softmax = nn.Softmax(dim=<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> valid_length <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">return</span> softmax(X)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        shape = X.shape</span><br><span class="line">        <span class="keyword">if</span> valid_length.dim() == <span class="number">1</span>: </span><br><span class="line"><span class="comment">#å¦‚æœæ˜¯ä¸€ç»´çš„è¯ï¼Œè¡¨ç¤ºæ²¡æœ‰è€ƒè™‘åˆ°æœ‰å¤šä¸ªbatch_sizeï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œè€ƒè™‘</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                valid_length = torch.FloatTensor(valid_length.numpy().repeat(shape[<span class="number">1</span>], axis=<span class="number">0</span>))<span class="comment">#[2,2,3,3] è¿›è¡Œrepeat æ˜¯æŒ‡éœ€è¦repeatäº†ç›¸åº”çš„æ­¥é•¿ç»´åº¦ç»™æ¯ä¸ªbatch</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                valid_length = torch.FloatTensor(valid_length.cpu().numpy().repeat(shape[<span class="number">1</span>], axis=<span class="number">0</span>))<span class="comment">#[2,2,3,3] è¿™é‡Œè€ƒè™‘äº†æ˜¯åœ¨å…·ä½“å“ªä¸ªdevice ä¸Šè¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            valid_length = valid_length.reshape((<span class="number">-1</span>,))</span><br><span class="line">        <span class="comment"># fill masked elements with a large negative, whose exp is 0</span></span><br><span class="line">        X = SequenceMask(X.reshape((<span class="number">-1</span>, shape[<span class="number">-1</span>])), valid_length)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> softmax(X).reshape(shape)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„mask çš„ä½œç”¨å’Œä¸Šä¸€èŠ‚ä¸­å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œç”±äºæ¯ä¸€å¥çš„é•¿åº¦æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯åœ¨è¿›è¡Œè®­ç»ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿æŒæ¯ä¸€å¥æ‰€å±•ç°å‡ºæ¥çš„ç»´åº¦æ˜¯ç›¸åŒçš„ï¼Œæ•…è€Œå¯¹äºç¼ºå°‘çš„ï¼Œä¼šè¿›è¡Œç›¸åº”çš„padding ,ä½†æ˜¯è¡¥è¶³çš„éƒ¨åˆ†ä¸åº”è¯¥çº³å…¥<code>softmax</code>çš„è®¡ç®—å½“ä¸­ã€‚</p>
<h4 id="ç»´åº¦"><a href="#ç»´åº¦" class="headerlink" title="ç»´åº¦"></a>ç»´åº¦</h4><p>æ·±åº¦å­¦ä¹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æ–¹é¢è¿›è¡Œåº”ç”¨çš„æ—¶å€™ï¼Œç»´åº¦æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸€ä¸ªç‚¹ï¼Œè¿™é‡Œä¸»è¦è¿›è¡Œä¸€ä¸‹è¯´æ˜ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè¾“å…¥çš„ç»´åº¦ä¸€èˆ¬éƒ½åŒ…æ‹¬äº†è¿™æ ·å‡ ä¸ªæ–¹é¢ï¼Œbatch_size ï¼Œæ­¥é•¿ï¼Œè¾“å…¥ç»´åº¦ã€‚å¯¹äºè¯­è¨€è€Œè¨€ï¼Œå…¶æœ¬èº«çš„ç½‘ç»œï¼Œä¸ä»…åŒ…æ‹¬äº†åŸæ¥çš„å°æ‰¹é‡è®­ç»ƒæ—¶å€™çš„batch_size å’Œ æœ¬æ¥ä¸€ä¸ªè¯­å¥çš„ç»´åº¦ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ—¶é—´ç»´åº¦ã€‚</p>
<p>ä¾‹å¦‚åœ¨è¿›è¡Œç›¸åº”çš„maskçš„æ—¶å€™ï¼Œå¯ä»¥å‚è§ä¸Šé¢çš„ä»£ç ä¸­æ‰€ç»™å‡ºçš„æ³¨é‡Šçš„å«ä¹‰ã€‚</p>
<h4 id="é«˜ç»´çŸ©é˜µç›¸ä¹˜"><a href="#é«˜ç»´çŸ©é˜µç›¸ä¹˜" class="headerlink" title="é«˜ç»´çŸ©é˜µç›¸ä¹˜"></a>é«˜ç»´çŸ©é˜µç›¸ä¹˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.bmm(torch.ones((<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>), dtype = torch.float), torch.ones((<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>), dtype = torch.float)) <span class="comment">#ä¸¤ä¸ªçŸ©é˜µä¹˜æ³•</span></span><br></pre></td></tr></table></figure>
<p><code>torch.bmm</code>æ˜¯çŸ©é˜µçš„ä¹˜æ³•ï¼Œå¯¹äºé«˜ç»´çŸ©é˜µï¼Œæ¯”å¦‚ä¸Šé¢çš„ä»£ç æ‰€å±•ç¤ºçš„é‚£æ ·ï¼Œå¾—åˆ°çš„shape = (2,1,2)</p>
<p>ä¸¤ä¸ªæ•°ç»„å°ºå¯¸è¦æ±‚ï¼š</p>
<ul>
<li>â€œ<strong>2ç»´ä»¥ä¸Š</strong>â€œçš„å°ºå¯¸å¿…é¡»å®Œå…¨å¯¹åº”ç›¸ç­‰ï¼›</li>
<li>â€œ<strong>2ç»´</strong>â€œå…·æœ‰å®é™…æ„ä¹‰çš„å•ä½ï¼Œåªè¦æ»¡è¶³çŸ©é˜µç›¸ä¹˜çš„å°ºå¯¸è§„å¾‹å³å¯ã€‚</li>
</ul>
<h3 id="ç‚¹ç§¯æ³¨æ„åŠ›"><a href="#ç‚¹ç§¯æ³¨æ„åŠ›" class="headerlink" title="ç‚¹ç§¯æ³¨æ„åŠ›"></a>ç‚¹ç§¯æ³¨æ„åŠ›</h3><p>The dot product å‡è®¾queryå’Œkeysæœ‰ç›¸åŒçš„ç»´åº¦, å³ $\forall i, ğª,ğ¤_ğ‘– âˆˆ â„_ğ‘‘ $. é€šè¿‡è®¡ç®—queryå’Œkeyè½¬ç½®çš„ä¹˜ç§¯æ¥è®¡ç®—attention score,é€šå¸¸è¿˜ä¼šé™¤å» $\sqrt{d}$ å‡å°‘è®¡ç®—å‡ºæ¥çš„scoreå¯¹ç»´åº¦ğ‘‘çš„ä¾èµ–æ€§ï¼Œå¦‚ä¸‹</p>
<script type="math/tex; mode=display">
ğ›¼(ğª,ğ¤)=âŸ¨ğª,ğ¤âŸ©/ \sqrt{d}</script><p>å‡è®¾ $ ğâˆˆâ„^{ğ‘šÃ—ğ‘‘}$ æœ‰ $m$ ä¸ªqueryï¼Œ$ğŠâˆˆâ„^{ğ‘›Ã—ğ‘‘}$ æœ‰ $n$ ä¸ªkeys. æˆ‘ä»¬å¯ä»¥é€šè¿‡çŸ©é˜µè¿ç®—çš„æ–¹å¼è®¡ç®—æ‰€æœ‰ $mn$ ä¸ªscoreï¼š</p>
<script type="math/tex; mode=display">
ğ›¼(ğ,ğŠ)=ğğŠ^ğ‘‡/\sqrt{d}</script><p>ç°åœ¨è®©æˆ‘ä»¬å®ç°è¿™ä¸ªå±‚ï¼Œå®ƒæ”¯æŒä¸€æ‰¹æŸ¥è¯¢å’Œé”®å€¼å¯¹ã€‚æ­¤å¤–ï¼Œå®ƒæ”¯æŒä½œä¸ºæ­£åˆ™åŒ–éšæœºåˆ é™¤ä¸€äº›æ³¨æ„åŠ›æƒé‡.</p>
<h3 id="å¤šå±‚æ„ŸçŸ¥æœºæ³¨æ„åŠ›"><a href="#å¤šå±‚æ„ŸçŸ¥æœºæ³¨æ„åŠ›" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœºæ³¨æ„åŠ›"></a>å¤šå±‚æ„ŸçŸ¥æœºæ³¨æ„åŠ›</h3><p>åœ¨å¤šå±‚æ„ŸçŸ¥å™¨ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°† query and keys æŠ•å½±åˆ°  $â„^â„$ .ä¸ºäº†æ›´å…·ä½“ï¼Œæˆ‘ä»¬å°†å¯ä»¥å­¦ä¹ çš„å‚æ•°åšå¦‚ä¸‹æ˜ å°„<br>$ğ–_ğ‘˜âˆˆâ„^{â„Ã—ğ‘‘_ğ‘˜}$ ,  $ğ–_ğ‘âˆˆâ„^{â„Ã—ğ‘‘_ğ‘}$ , and  $ğ¯âˆˆâ„^h$ . å°†scoreå‡½æ•°å®šä¹‰</p>
<script type="math/tex; mode=display">
ğ›¼(ğ¤,ğª)=ğ¯^ğ‘‡tanh(ğ–_ğ‘˜ğ¤+ğ–_ğ‘ğª)</script><p>.<br>ç„¶åå°†key å’Œ value åœ¨ç‰¹å¾çš„ç»´åº¦ä¸Šåˆå¹¶ï¼ˆconcatenateï¼‰ï¼Œç„¶åé€è‡³ a single hidden layer perceptron è¿™å±‚ä¸­ hidden layer ä¸º  â„  and è¾“å‡ºçš„sizeä¸º 1 .éšå±‚æ¿€æ´»å‡½æ•°ä¸ºtanhï¼Œæ— åç½®.</p>
<h3 id="å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶çš„Seq2seqæ¨¡å‹"><a href="#å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶çš„Seq2seqæ¨¡å‹" class="headerlink" title="å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶çš„Seq2seqæ¨¡å‹"></a>å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶çš„Seq2seqæ¨¡å‹</h3><p>å°†æ³¨æ„æœºåˆ¶æ·»åŠ åˆ°sequence to sequence æ¨¡å‹ä¸­ï¼Œä»¥æ˜¾å¼åœ°ä½¿ç”¨æƒé‡èšåˆstatesã€‚ä¸‹å›¾å±•ç¤ºencoding å’Œdecodingçš„æ¨¡å‹ç»“æ„ï¼Œåœ¨æ—¶é—´æ­¥ä¸ºtçš„æ—¶å€™ã€‚æ­¤åˆ»attention layerä¿å­˜ç€encoderingçœ‹åˆ°çš„æ‰€æœ‰ä¿¡æ¯â€”â€”å³encodingçš„æ¯ä¸€æ­¥è¾“å‡ºã€‚åœ¨decodingé˜¶æ®µï¼Œè§£ç å™¨çš„$t$æ—¶åˆ»çš„éšè—çŠ¶æ€è¢«å½“ä½œqueryï¼Œencoderçš„æ¯ä¸ªæ—¶é—´æ­¥çš„hidden statesä½œä¸ºkeyå’Œvalueè¿›è¡Œattentionèšåˆ. Attetion modelçš„è¾“å‡ºå½“ä½œæˆä¸Šä¸‹æ–‡ä¿¡æ¯context vectorï¼Œå¹¶ä¸è§£ç å™¨è¾“å…¥$D_t$æ‹¼æ¥èµ·æ¥ä¸€èµ·é€åˆ°è§£ç å™¨ï¼š</p>
<p><img src="https://cdn.kesci.com/upload/image/q5km7o8z93.PNG?imageView2/0/w/800/h/800" alt="Image Name"></p>
<script type="math/tex; mode=display">
Fig1å…·æœ‰æ³¨æ„æœºåˆ¶çš„seq-to-seqæ¨¡å‹è§£ç çš„ç¬¬äºŒæ­¥</script><p>ä¸‹å›¾å±•ç¤ºäº†seq2seqæœºåˆ¶çš„æ‰€æœ‰å±‚çš„å…³ç³»ï¼Œä¸‹é¢å±•ç¤ºäº†encoderå’Œdecoderçš„layerç»“æ„</p>
<p><img src="https://cdn.kesci.com/upload/image/q5km8dihlr.PNG?imageView2/0/w/800/h/800" alt="Image Name"></p>
<script type="math/tex; mode=display">
Fig2å…·æœ‰æ³¨æ„æœºåˆ¶çš„seq-to-seqæ¨¡å‹ä¸­å±‚ç»“æ„</script><h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><p>åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†ä¸»æµçš„ç¥ç»ç½‘ç»œæ¶æ„å¦‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNsï¼‰å’Œå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNsï¼‰ã€‚è®©æˆ‘ä»¬è¿›è¡Œä¸€äº›å›é¡¾ï¼š</p>
<ul>
<li>CNNs æ˜“äºå¹¶è¡ŒåŒ–ï¼Œå´ä¸é€‚åˆæ•æ‰å˜é•¿åºåˆ—å†…çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>RNNs é€‚åˆæ•æ‰é•¿è·ç¦»å˜é•¿åºåˆ—çš„ä¾èµ–ï¼Œä½†æ˜¯å´éš¾ä»¥å®ç°å¹¶è¡ŒåŒ–å¤„ç†åºåˆ—ã€‚</li>
</ul>
<p>ä¸ºäº†æ•´åˆCNNå’ŒRNNçš„ä¼˜åŠ¿ï¼Œ<a href="https://d2l.ai/chapter_references/zreferences.html#vaswani-shazeer-parmar-ea-2017" target="_blank" rel="noopener">[Vaswani et al., 2017]</a> åˆ›æ–°æ€§åœ°ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶è®¾è®¡äº†Transformeræ¨¡å‹ã€‚è¯¥æ¨¡å‹åˆ©ç”¨attentionæœºåˆ¶å®ç°äº†å¹¶è¡ŒåŒ–æ•æ‰åºåˆ—ä¾èµ–ï¼Œå¹¶ä¸”åŒæ—¶å¤„ç†åºåˆ—çš„æ¯ä¸ªä½ç½®çš„tokensï¼Œä¸Šè¿°ä¼˜åŠ¿ä½¿å¾—Transformeræ¨¡å‹åœ¨æ€§èƒ½ä¼˜å¼‚çš„åŒæ—¶å¤§å¤§å‡å°‘äº†è®­ç»ƒæ—¶é—´ã€‚</p>
<p>å›¾10.3.1å±•ç¤ºäº†Transformeræ¨¡å‹çš„æ¶æ„ï¼Œä¸seq2seqæ¨¡å‹ç›¸ä¼¼ï¼ŒTransformeråŒæ ·åŸºäºç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œå…¶åŒºåˆ«ä¸»è¦åœ¨äºä»¥ä¸‹ä¸‰ç‚¹ï¼š</p>
<ol>
<li>Transformer blocksï¼šå°†seq2seqæ¨¡å‹é‡çš„å¾ªç¯ç½‘ç»œæ›¿æ¢ä¸ºäº†Transformer Blocksï¼Œè¯¥æ¨¡å—åŒ…å«ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›å±‚ï¼ˆMulti-head Attention Layersï¼‰ä»¥åŠä¸¤ä¸ªposition-wise feed-forward networksï¼ˆFFNï¼‰ã€‚å¯¹äºè§£ç å™¨æ¥è¯´ï¼Œå¦ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›å±‚è¢«ç”¨äºæ¥å—ç¼–ç å™¨çš„éšè—çŠ¶æ€ã€‚</li>
<li>Add and normï¼šå¤šå¤´æ³¨æ„åŠ›å±‚å’Œå‰é¦ˆç½‘ç»œçš„è¾“å‡ºè¢«é€åˆ°ä¸¤ä¸ªâ€œadd and normâ€å±‚è¿›è¡Œå¤„ç†ï¼Œè¯¥å±‚åŒ…å«æ®‹å·®ç»“æ„ä»¥åŠå±‚å½’ä¸€åŒ–ã€‚</li>
<li>Position encodingï¼šç”±äºè‡ªæ³¨æ„åŠ›å±‚å¹¶æ²¡æœ‰åŒºåˆ†å…ƒç´ çš„é¡ºåºï¼Œæ‰€ä»¥ä¸€ä¸ªä½ç½®ç¼–ç å±‚è¢«ç”¨äºå‘åºåˆ—å…ƒç´ é‡Œæ·»åŠ ä½ç½®ä¿¡æ¯ã€‚</li>
</ol>
<p><img src="https://cdn.kesci.com/upload/image/q5kpbj2cj5.png?imageView2/0/w/960/h/960" alt="Fig. 10.3.1 The Transformer architecture."></p>
<script type="math/tex; mode=display">
Fig.10.3.1\ Transformer æ¶æ„.</script><h3 id="å¤šå¤´æ³¨æ„åŠ›å±‚"><a href="#å¤šå¤´æ³¨æ„åŠ›å±‚" class="headerlink" title="å¤šå¤´æ³¨æ„åŠ›å±‚"></a>å¤šå¤´æ³¨æ„åŠ›å±‚</h3><p>åœ¨æˆ‘ä»¬è®¨è®ºå¤šå¤´æ³¨æ„åŠ›å±‚ä¹‹å‰ï¼Œå…ˆæ¥è¿…é€Ÿç†è§£ä»¥ä¸‹è‡ªæ³¨æ„åŠ›ï¼ˆself-attentionï¼‰çš„ç»“æ„ã€‚è‡ªæ³¨æ„åŠ›æ¨¡å‹æ˜¯ä¸€ä¸ªæ­£è§„çš„æ³¨æ„åŠ›æ¨¡å‹ï¼Œåºåˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”çš„keyï¼Œvalueï¼Œqueryæ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚å¦‚å›¾10.3.2 è‡ªæ³¨æ„åŠ›è¾“å‡ºäº†ä¸€ä¸ªä¸è¾“å…¥é•¿åº¦ç›¸åŒçš„è¡¨å¾åºåˆ—ï¼Œä¸å¾ªç¯ç¥ç»ç½‘ç»œç›¸æ¯”ï¼Œè‡ªæ³¨æ„åŠ›å¯¹æ¯ä¸ªå…ƒç´ è¾“å‡ºçš„è®¡ç®—æ˜¯å¹¶è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é«˜æ•ˆçš„å®ç°è¿™ä¸ªæ¨¡å—ã€‚</p>
<p><img src="https://cdn.kesci.com/upload/image/q5kpckv38q.png?imageView2/0/w/320/h/320" alt="Fig. 10.3.2 è‡ªæ³¨æ„åŠ›ç»“æ„"></p>
<script type="math/tex; mode=display">
Fig.10.3.2\ è‡ªæ³¨æ„åŠ›ç»“æ„</script><p>å¤šå¤´æ³¨æ„åŠ›å±‚åŒ…å«$h$ä¸ªå¹¶è¡Œçš„è‡ªæ³¨æ„åŠ›å±‚ï¼Œæ¯ä¸€ä¸ªè¿™ç§å±‚è¢«æˆä¸ºä¸€ä¸ªheadã€‚å¯¹æ¯ä¸ªå¤´æ¥è¯´ï¼Œåœ¨è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå°†queryã€keyå’Œvalueç”¨ä¸‰ä¸ªç°è¡Œå±‚è¿›è¡Œæ˜ å°„ï¼Œè¿™$h$ä¸ªæ³¨æ„åŠ›å¤´çš„è¾“å‡ºå°†ä¼šè¢«æ‹¼æ¥ä¹‹åè¾“å…¥æœ€åä¸€ä¸ªçº¿æ€§å±‚è¿›è¡Œæ•´åˆã€‚</p>
<p><img src="https://cdn.kesci.com/upload/image/q5kpcsozid.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<script type="math/tex; mode=display">
Fig.10.3.3\ å¤šå¤´æ³¨æ„åŠ›</script><p>å‡è®¾queryï¼Œkeyå’Œvalueçš„ç»´åº¦åˆ†åˆ«æ˜¯$d_q$ã€$d_k$å’Œ$d_v$ã€‚é‚£ä¹ˆå¯¹äºæ¯ä¸€ä¸ªå¤´$i=1,\ldots,h$ï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒç›¸åº”çš„æ¨¡å‹æƒé‡$W_q^{(i)} \in \mathbb{R}^{p_q\times d_q}$ã€$W_k^{(i)} \in \mathbb{R}^{p_k\times d_k}$å’Œ$W_v^{(i)} \in \mathbb{R}^{p_v\times d_v}$ï¼Œä»¥å¾—åˆ°æ¯ä¸ªå¤´çš„è¾“å‡ºï¼š</p>
<script type="math/tex; mode=display">
o^{(i)} = attention(W_q^{(i)}q, W_k^{(i)}k, W_v^{(i)}v)</script><p>è¿™é‡Œçš„attentionå¯ä»¥æ˜¯ä»»æ„çš„attention functionï¼Œæ¯”å¦‚å‰ä¸€èŠ‚ä»‹ç»çš„dot-product attentionä»¥åŠMLP attentionã€‚ä¹‹åæˆ‘ä»¬å°†æ‰€æœ‰headå¯¹åº”çš„è¾“å‡ºæ‹¼æ¥èµ·æ¥ï¼Œé€å…¥æœ€åä¸€ä¸ªçº¿æ€§å±‚è¿›è¡Œæ•´åˆï¼Œè¿™ä¸ªå±‚çš„æƒé‡å¯ä»¥è¡¨ç¤ºä¸º$W_o\in \mathbb{R}^{d_0 \times hp_v}$</p>
<script type="math/tex; mode=display">
o = W_o[o^{(1)}, \ldots, o^{(h)}]</script><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ¥å®ç°å¤šå¤´æ³¨æ„åŠ›äº†ï¼Œå‡è®¾æˆ‘ä»¬æœ‰hä¸ªå¤´ï¼Œéšè—å±‚æƒé‡ $hidden_size = p_q = p_k = p_v$ ä¸queryï¼Œkeyï¼Œvalueçš„ç»´åº¦ä¸€è‡´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºå¤šå¤´æ³¨æ„åŠ›å±‚ä¿æŒè¾“å…¥ä¸è¾“å‡ºå¼ é‡çš„ç»´åº¦ä¸å˜ï¼Œæ‰€ä»¥è¾“å‡ºfeatureçš„ç»´åº¦ä¹Ÿè®¾ç½®ä¸º $d_0 = hidden_size$ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiHeadAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_size, hidden_size, num_heads, dropout, **kwargs)</span>:</span></span><br><span class="line">        super(MultiHeadAttention, self).__init__(**kwargs)</span><br><span class="line">        self.num_heads = num_heads</span><br><span class="line">        self.attention = DotProductAttention(dropout)</span><br><span class="line">        self.W_q = nn.Linear(input_size, hidden_size, bias=<span class="keyword">False</span>)</span><br><span class="line">        self.W_k = nn.Linear(input_size, hidden_size, bias=<span class="keyword">False</span>)</span><br><span class="line">        self.W_v = nn.Linear(input_size, hidden_size, bias=<span class="keyword">False</span>)</span><br><span class="line">        self.W_o = nn.Linear(hidden_size, hidden_size, bias=<span class="keyword">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, query, key, value, valid_length)</span>:</span></span><br><span class="line">        <span class="comment"># query, key, and value shape: (batch_size, seq_len, dim),</span></span><br><span class="line">        <span class="comment"># where seq_len is the length of input sequence</span></span><br><span class="line">        <span class="comment"># valid_length shape is either (batch_size, )</span></span><br><span class="line">        <span class="comment"># or (batch_size, seq_len).</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Project and transpose query, key, and value from</span></span><br><span class="line">        <span class="comment"># (batch_size, seq_len, hidden_size * num_heads) to</span></span><br><span class="line">        <span class="comment"># (batch_size * num_heads, seq_len, hidden_size).</span></span><br><span class="line">        </span><br><span class="line">        query = transpose_qkv(self.W_q(query), self.num_heads)</span><br><span class="line">        key = transpose_qkv(self.W_k(key), self.num_heads)</span><br><span class="line">        value = transpose_qkv(self.W_v(value), self.num_heads)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> valid_length <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># Copy valid_length by num_heads times</span></span><br><span class="line">            device = valid_length.device</span><br><span class="line">            valid_length = valid_length.cpu().numpy() <span class="keyword">if</span> valid_length.is_cuda <span class="keyword">else</span> valid_length.numpy()</span><br><span class="line">            <span class="keyword">if</span> valid_length.ndim == <span class="number">1</span>:</span><br><span class="line">                valid_length = torch.FloatTensor(np.tile(valid_length, self.num_heads))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                valid_length = torch.FloatTensor(np.tile(valid_length, (self.num_heads,<span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">            valid_length = valid_length.to(device)</span><br><span class="line">            </span><br><span class="line">        output = self.attention(query, key, value, valid_length)</span><br><span class="line">        output_concat = transpose_output(output, self.num_heads)</span><br><span class="line">        <span class="keyword">return</span> self.W_o(output_concat)</span><br></pre></td></tr></table></figure>
<p>å…³äºå…¶ä¸­å®ç°çš„ä»£ç ï¼Œé¦–å…ˆè¦æ³¨æ„å…¶ç»´åº¦ä¸Šçš„å˜åŒ–ï¼Œå¯¹äºquery , key å’Œ value ï¼Œå…¶æœ¬èº«åœ¨ç»´åº¦ä¸Šéƒ½æ˜¯(batch_size , seq_len , dim )ï¼Œè¿™å’Œä¹‹å‰çš„æ˜¯ç›¸åŒçš„ï¼Œç„¶ååˆ©ç”¨transpose ä¼šå°†æœ€åä¸€ç»´å˜æˆä¸¤ç»´ï¼Œå€’æ•°ç¬¬äºŒç»´æ˜¯head_numsï¼Œç„¶åå†è¿›è¡Œå˜æ¢ï¼Œå…·ä½“å¯å‚è§å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transpose_qkv</span><span class="params">(X, num_heads)</span>:</span></span><br><span class="line">    <span class="comment"># Original X shape: (batch_size, seq_len, hidden_size * num_heads),</span></span><br><span class="line">    <span class="comment"># -1 means inferring its value, after first reshape, X shape:</span></span><br><span class="line">    <span class="comment"># (batch_size, seq_len, num_heads, hidden_size)</span></span><br><span class="line">    X = X.view(X.shape[<span class="number">0</span>], X.shape[<span class="number">1</span>], num_heads, <span class="number">-1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># After transpose, X shape: (batch_size, num_heads, seq_len, hidden_size)</span></span><br><span class="line">    X = X.transpose(<span class="number">2</span>, <span class="number">1</span>).contiguous()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Merge the first two dimensions. Use reverse=True to infer shape from</span></span><br><span class="line">    <span class="comment"># right to left.</span></span><br><span class="line">    <span class="comment"># output shape: (batch_size * num_heads, seq_len, hidden_size)</span></span><br><span class="line">    output = X.view(<span class="number">-1</span>, X.shape[<span class="number">2</span>], X.shape[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>
<p>å…³äº<code>np.tile</code>å‡½æ•°ï¼šå®˜æ–¹æ–‡æ¡£ä¸º</p>
<p><code>Construct an array by repeating A the number of times given by reps.</code></p>
<p>If <em>reps</em> has length <code>d</code>, the result will have dimension of <code>max(d, A.ndim)</code>.</p>
<p>If <code>A.ndim &lt; d</code>, <em>A</em> is promoted to be d-dimensional by prepending new axes. So a shape (3,) array is promoted to (1, 3) for 2-D replication, or shape (1, 1, 3) for 3-D replication. If this is not the desired behavior, promote <em>A</em> to d-dimensions manually before calling this function.</p>
<p>If <code>A.ndim &gt; d</code>, <em>reps</em> is promoted to <em>A</em>.ndim by pre-pending 1â€™s to it. Thus for an <em>A</em> of shape (2, 3, 4, 5), a <em>reps</em> of (2, 2) is treated as (1, 1, 2, 2).</p>
<p>æ³¨æ„ç»´åº¦çš„è°ƒæ¢</p>
<p>æœ€åçš„output çš„ shape  : (batch_size,seq_len,hide_size * head_nums)</p>
<h3 id="åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ"><a href="#åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ" class="headerlink" title="åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ"></a>åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ</h3><p>å…¶æ•ˆæœä¸»è¦ç”¨äºå˜æ¢ç»´åº¦ï¼Œå®é™…ä¸Šå°±ç­‰åŒäºä¸€ä¸ª$1 \times 1$çš„å·ç§¯å±‚</p>
<h3 id="Add-and-Norm"><a href="#Add-and-Norm" class="headerlink" title="Add and Norm"></a>Add and Norm</h3><p>é™¤äº†ä¸Šé¢ä¸¤ä¸ªæ¨¡å—ä¹‹å¤–ï¼ŒTransformerè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç›¸åŠ å½’ä¸€åŒ–å±‚ï¼Œå®ƒå¯ä»¥å¹³æ»‘åœ°æ•´åˆè¾“å…¥å’Œå…¶ä»–å±‚çš„è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¯ä¸ªå¤šå¤´æ³¨æ„åŠ›å±‚å’ŒFFNå±‚åé¢éƒ½æ·»åŠ ä¸€ä¸ªå«æ®‹å·®è¿æ¥çš„Layer Normå±‚ã€‚è¿™é‡Œ Layer Norm ä¸7.5å°èŠ‚çš„Batch Normå¾ˆç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºBatch Normæ˜¯å¯¹äºbatch sizeè¿™ä¸ªç»´åº¦è¿›è¡Œè®¡ç®—å‡å€¼å’Œæ–¹å·®çš„ï¼Œè€ŒLayer Normåˆ™æ˜¯å¯¹æœ€åä¸€ç»´è¿›è¡Œè®¡ç®—ã€‚å±‚å½’ä¸€åŒ–å¯ä»¥é˜²æ­¢å±‚å†…çš„æ•°å€¼å˜åŒ–è¿‡å¤§ï¼Œä»è€Œæœ‰åˆ©äºåŠ å¿«è®­ç»ƒé€Ÿåº¦å¹¶ä¸”æé«˜æ³›åŒ–æ€§èƒ½ã€‚ <a href="https://zhuanlan.zhihu.com/p/54530247" target="_blank" rel="noopener">(ref)</a> </p>
<p>ä¸å¾ªç¯ç¥ç»ç½‘ç»œä¸åŒï¼Œæ— è®ºæ˜¯å¤šå¤´æ³¨æ„åŠ›ç½‘ç»œè¿˜æ˜¯å‰é¦ˆç¥ç»ç½‘ç»œéƒ½æ˜¯ç‹¬ç«‹åœ°å¯¹æ¯ä¸ªä½ç½®çš„å…ƒç´ è¿›è¡Œæ›´æ–°ï¼Œè¿™ç§ç‰¹æ€§å¸®åŠ©æˆ‘ä»¬å®ç°äº†é«˜æ•ˆçš„å¹¶è¡Œï¼Œå´ä¸¢å¤±äº†é‡è¦çš„åºåˆ—é¡ºåºçš„ä¿¡æ¯ã€‚ä¸ºäº†æ›´å¥½çš„æ•æ‰åºåˆ—ä¿¡æ¯ï¼ŒTransformeræ¨¡å‹å¼•å…¥äº†ä½ç½®ç¼–ç å»ä¿æŒè¾“å…¥åºåˆ—å…ƒç´ çš„ä½ç½®ã€‚</p>
<p>å‡è®¾è¾“å…¥åºåˆ—çš„åµŒå…¥è¡¨ç¤º $X\in \mathbb{R}^{l\times d}$, åºåˆ—é•¿åº¦ä¸º$l$åµŒå…¥å‘é‡ç»´åº¦ä¸º$d$ï¼Œåˆ™å…¶ä½ç½®ç¼–ç ä¸º$P \in \mathbb{R}^{l\times d}$ ï¼Œè¾“å‡ºçš„å‘é‡å°±æ˜¯äºŒè€…ç›¸åŠ  $X + P$ã€‚</p>
<h3 id="ä½ç½®ç¼–ç "><a href="#ä½ç½®ç¼–ç " class="headerlink" title="ä½ç½®ç¼–ç "></a>ä½ç½®ç¼–ç </h3><p>ä½ç½®ç¼–ç æ˜¯ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼Œiå¯¹åº”ç€åºåˆ—ä¸­çš„é¡ºåºï¼Œjå¯¹åº”å…¶embedding vectorå†…éƒ¨çš„ç»´åº¦ç´¢å¼•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ç­‰å¼è®¡ç®—ä½ç½®ç¼–ç ï¼š</p>
<script type="math/tex; mode=display">
P_{i,2j} = sin(i/10000^{2j/d})</script><script type="math/tex; mode=display">
P_{i,2j+1} = cos(i/10000^{2j/d})</script><script type="math/tex; mode=display">
for\ i=0,\ldots, l-1\ and\ j=0,\ldots,\lfloor (d-1)/2 \rfloor</script><p><img src="https://cdn.kesci.com/upload/image/q5kpe0lu38.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<script type="math/tex; mode=display">
Fig. 10.3.4\ ä½ç½®ç¼–ç </script><p>å¯¹äºtransformerè€Œè¨€ï¼Œæœ¬èº«æ²¡æœ‰åŒ…å«ä½ç½®çš„æ€§è´¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> self.training:</span><br><span class="line">            batch_size, seq_len, _ = X.shape</span><br><span class="line">            <span class="comment"># Shape: (batch_size, seq_len), the values in the j-th column are j+1</span></span><br><span class="line">            valid_length = torch.FloatTensor(np.tile(np.arange(<span class="number">1</span>, seq_len+<span class="number">1</span>), (batch_size, <span class="number">1</span>))) </span><br><span class="line">            valid_length = valid_length.to(X.device)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            valid_length = <span class="keyword">None</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œè¦ç†è§£ä¸€ä¸‹ï¼Œå¯¹äºè®­ç»ƒå’Œé¢„æµ‹ï¼Œå…¶è¾“å…¥æ˜¯ä¸åŒçš„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šç›´æ¥è¾“å…¥æ•´ä¸ªtargetsçš„æ‰€æœ‰tokensï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¸ºäº†ä¿è¯å…¶ä¸çœ‹åˆ°åé¢çš„ç»“æœæ¥è¿›è¡Œlossçš„è®­ç»ƒï¼Œéœ€è¦è®¾å®šå½“å‰çš„<code>valid_length</code>ï¼Œç›¸å½“äºåªçœ‹åˆ°äº†seq_len+1 è¿™ä¸€ä¸ªtokensä¸ºæ­¢ã€‚</p>
<h2 id="å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€"><a href="#å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€"></a>å·ç§¯ç¥ç»ç½‘ç»œåŸºç¡€</h2><p>è¾“å…¥ç»´åº¦ï¼š</p>
<p>å¯¹äºå·ç§¯ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œä¸€èˆ¬çš„è¾“å…¥Xå’Œä¸­é—´çš„éšè—å±‚ï¼Œéƒ½å…·æœ‰4ä¸ªç»´åº¦ï¼Œå…¶åˆ†åˆ«æ˜¯ï¼š</p>
<p>(batch_size, channels,length,width)</p>
<p>å¯¹äºå…¶ä»–éƒ¨åˆ†ï¼Œåº”è¯¥å°±æ¯”è¾ƒå¥½ç†è§£ã€‚</p>
<h2 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h2><p>LeNetæ˜¯ä¸€ä¸ªæœ€ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚</p>
<p>ä½¿ç”¨å…¨è¿æ¥å±‚çš„å±€é™æ€§ï¼š</p>
<ul>
<li>å›¾åƒåœ¨åŒä¸€åˆ—é‚»è¿‘çš„åƒç´ åœ¨è¿™ä¸ªå‘é‡ä¸­å¯èƒ½ç›¸è·è¾ƒè¿œã€‚å®ƒä»¬æ„æˆçš„æ¨¡å¼å¯èƒ½éš¾ä»¥è¢«æ¨¡å‹è¯†åˆ«ã€‚</li>
<li>å¯¹äºå¤§å°ºå¯¸çš„è¾“å…¥å›¾åƒï¼Œä½¿ç”¨å…¨è¿æ¥å±‚å®¹æ˜“å¯¼è‡´æ¨¡å‹è¿‡å¤§ã€‚</li>
</ul>
<p>ä½¿ç”¨å·ç§¯å±‚çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å·ç§¯å±‚ä¿ç•™è¾“å…¥å½¢çŠ¶ã€‚</li>
<li>å·ç§¯å±‚é€šè¿‡æ»‘åŠ¨çª—å£å°†åŒä¸€å·ç§¯æ ¸ä¸ä¸åŒä½ç½®çš„è¾“å…¥é‡å¤è®¡ç®—ï¼Œä»è€Œé¿å…å‚æ•°å°ºå¯¸è¿‡å¤§ã€‚</li>
</ul>
<h2 id="å·ç§¯ç¥ç»ç½‘ç»œè¿›é˜¶"><a href="#å·ç§¯ç¥ç»ç½‘ç»œè¿›é˜¶" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œè¿›é˜¶"></a>å·ç§¯ç¥ç»ç½‘ç»œè¿›é˜¶</h2><p>ä¸»è¦ä»‹ç»äº†å‡ ä¸ªç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œ</p>
<h3 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h3><p>é¦–æ¬¡è¯æ˜äº†å­¦ä¹ åˆ°çš„ç‰¹å¾å¯ä»¥è¶…è¶Šâ¼¿â¼¯è®¾è®¡çš„ç‰¹å¾ï¼Œä»è€Œâ¼€ä¸¾æ‰“ç ´è®¡ç®—æœºè§†è§‰ç ”ç©¶çš„å‰çŠ¶ã€‚<br> <strong>ç‰¹å¾ï¼š</strong></p>
<ol>
<li>8å±‚å˜æ¢ï¼Œå…¶ä¸­æœ‰5å±‚å·ç§¯å’Œ2å±‚å…¨è¿æ¥éšè—å±‚ï¼Œä»¥åŠ1ä¸ªå…¨è¿æ¥è¾“å‡ºå±‚ã€‚</li>
<li>å°†sigmoidæ¿€æ´»å‡½æ•°æ”¹æˆäº†æ›´åŠ ç®€å•çš„ReLUæ¿€æ´»å‡½æ•°ã€‚</li>
<li>ç”¨Dropoutæ¥æ§åˆ¶å…¨è¿æ¥å±‚çš„æ¨¡å‹å¤æ‚åº¦ã€‚</li>
<li>å¼•å…¥æ•°æ®å¢å¼ºï¼Œå¦‚ç¿»è½¬ã€è£å‰ªå’Œé¢œè‰²å˜åŒ–ï¼Œä»è€Œè¿›ä¸€æ­¥æ‰©å¤§æ•°æ®é›†æ¥ç¼“è§£è¿‡æ‹Ÿåˆã€‚</li>
</ol>
<h3 id="ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"><a href="#ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰" class="headerlink" title="ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"></a>ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰</h3><p>VGGï¼šé€šè¿‡é‡å¤ä½¿â½¤ç®€å•çš„åŸºç¡€å—æ¥æ„å»ºæ·±åº¦æ¨¡å‹ã€‚<br> Block:æ•°ä¸ªç›¸åŒçš„å¡«å……ä¸º1ã€çª—å£å½¢çŠ¶ä¸º</p>
<p>çš„å·ç§¯å±‚,æ¥ä¸Šä¸€ä¸ªæ­¥å¹…ä¸º2ã€çª—å£å½¢çŠ¶ä¸ºçš„æœ€å¤§æ± åŒ–å±‚ã€‚<br> å·ç§¯å±‚ä¿æŒè¾“å…¥çš„é«˜å’Œå®½ä¸å˜ï¼Œè€Œæ± åŒ–å±‚åˆ™å¯¹å…¶å‡åŠã€‚</p>
<p><img src="https://cdn.kesci.com/upload/image/q5l6vut7h1.png?imageView2/0/w/640/h/640" alt="Image Name"></p>
<h3 id="ç½‘ç»œä¸­çš„ç½‘ç»œ-NiN"><a href="#ç½‘ç»œä¸­çš„ç½‘ç»œ-NiN" class="headerlink" title="ç½‘ç»œä¸­çš„ç½‘ç»œ(NiN)"></a>ç½‘ç»œä¸­çš„ç½‘ç»œ(NiN)</h3><p>LeNetã€AlexNetå’ŒVGGï¼šå…ˆä»¥ç”±å·ç§¯å±‚æ„æˆçš„æ¨¡å—å……åˆ†æŠ½å– ç©ºé—´ç‰¹å¾ï¼Œå†ä»¥ç”±å…¨è¿æ¥å±‚æ„æˆçš„æ¨¡å—æ¥è¾“å‡ºåˆ†ç±»ç»“æœã€‚<br> NiNï¼šä¸²è”å¤šä¸ªç”±å·ç§¯å±‚å’Œâ€œå…¨è¿æ¥â€å±‚æ„æˆçš„å°â½¹ç»œæ¥æ„å»ºâ¼€ä¸ªæ·±å±‚â½¹ç»œã€‚<br> â½¤äº†è¾“å‡ºé€šé“æ•°ç­‰äºæ ‡ç­¾ç±»åˆ«æ•°çš„NiNå—ï¼Œç„¶åä½¿â½¤å…¨å±€å¹³å‡æ± åŒ–å±‚å¯¹æ¯ä¸ªé€šé“ä¸­æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡å¹¶ç›´æ¥â½¤äºåˆ†ç±»ã€‚</p>
<p><img src="https://cdn.kesci.com/upload/image/q5l6u1p5vy.png?imageView2/0/w/960/h/960" alt="Image Name"></p>
<h3 id="GoogLeNet"><a href="#GoogLeNet" class="headerlink" title="GoogLeNet"></a>GoogLeNet</h3><ol>
<li>ç”±InceptionåŸºç¡€å—ç»„æˆã€‚  </li>
<li>Inceptionå—ç›¸å½“äºâ¼€ä¸ªæœ‰4æ¡çº¿è·¯çš„â¼¦â½¹ç»œã€‚å®ƒé€šè¿‡ä¸åŒçª—å£å½¢çŠ¶çš„å·ç§¯å±‚å’Œæœ€â¼¤æ± åŒ–å±‚æ¥å¹¶â¾æŠ½å–ä¿¡æ¯ï¼Œå¹¶ä½¿â½¤1Ã—1å·ç§¯å±‚å‡å°‘é€šé“æ•°ä»è€Œé™ä½æ¨¡å‹å¤æ‚åº¦ã€‚   </li>
<li>å¯ä»¥â¾ƒå®šä¹‰çš„è¶…å‚æ•°æ˜¯æ¯ä¸ªå±‚çš„è¾“å‡ºé€šé“æ•°ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚ </li>
</ol>
<p><img src="https://cdn.kesci.com/upload/image/q5l6uortw.png?imageView2/0/w/640/h/640" alt="Image Name"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2020/02/14/pytorch1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/14/pytorch1/" itemprop="url">pytorch1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-14T11:51:18+08:00">
                2020-02-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ -task1"><a href="#åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ -task1" class="headerlink" title="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  task1"></a>åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  task1</h1><hr>
<h2 id="çº¿æ€§å›å½’"><a href="#çº¿æ€§å›å½’" class="headerlink" title="çº¿æ€§å›å½’"></a>çº¿æ€§å›å½’</h2><p>å¯¹äºç®€å•çš„çº¿æ€§å›å½’è€Œè¨€ï¼Œå®é™…ä¸Šå°±éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªçº¿æ€§å±‚å³å¯ã€‚å¯¹äºpythonè€Œè¨€ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ç§‘å­¦è®¡ç®—æä¾›çš„çŸ¢é‡è¿ç®—è¦æ¯”åˆ©ç”¨å¾ªç¯å®ç°çš„æ•ˆç‡é«˜å¾ˆå¤šã€‚è¿™é‡Œå®é™…ä¸Šè·ŸCPUæœ¬èº«çš„æŒ‡ä»¤é›†æ‰©å±•æœ‰å…³ï¼ŒåŒ…æ‹¬AVXå’ŒMMEçš„çŸ¢é‡è¿ç®—æŒ‡ä»¤ã€‚</p>
<h3 id="yield-ä½¿ç”¨"><a href="#yield-ä½¿ç”¨" class="headerlink" title="yield ä½¿ç”¨"></a>yield ä½¿ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_iter</span><span class="params">(batch_size, features, labels)</span>:</span></span><br><span class="line">    num_examples = len(features)</span><br><span class="line">    indices = list(range(num_examples))</span><br><span class="line">    random.shuffle(indices)  <span class="comment"># random read 10 samples</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, num_examples, batch_size):</span><br><span class="line">        j = torch.LongTensor(indices[i: min(i + batch_size, num_examples)]) <span class="comment"># the last time may be not enough for a whole batch</span></span><br><span class="line">        <span class="keyword">yield</span>  features.index_select(<span class="number">0</span>, j), labels.index_select(<span class="number">0</span>, j)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œä½¿ç”¨äº†yieldï¼Œè¿™é‡Œçš„yield æœ‰ä¸¤ä¸ªä½œç”¨ï¼ŒåŒ…æ‹¬return å’Œä¸€ä¸ªè¿­ä»£å™¨çš„ä½œç”¨ã€‚åœ¨python ä¸­ï¼Œè¿™æ ·çš„ä¾‹å­è¿˜åŒ…æ‹¬ä¹‹å‰æœ‰çš„xrangeï¼Œå³ç°åœ¨çš„rangeï¼Œå¦‚æœå»æ‰“å°type(range(10))ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çš„rangeè¿”å›çš„ä¹Ÿæ˜¯è¿™æ ·ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>
<h3 id="å°æ‰¹é‡è®¡ç®—"><a href="#å°æ‰¹é‡è®¡ç®—" class="headerlink" title="å°æ‰¹é‡è®¡ç®—"></a>å°æ‰¹é‡è®¡ç®—</h3><p>batch normalization æ˜¯ä¸¤ç§ä¸åŒæ–¹å¼çš„ä¸­å’Œï¼Œæ—¢ä¸éœ€è¦è®¡ç®—æ•´ä¸ªæ‰¹é‡çš„æ‰€æœ‰æ•°æ®æ¥è¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼Œä¹Ÿä¸ç”±äºæŸäº›æå°‘æ•°çš„ç‚¹æ¥å¯¼è‡´ä¸‹é™çš„æ–¹å‘ä¸å¯¹ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå°æ‰¹é‡çš„è®¡ç®—æ˜¯ç”¨äºå¯¹äºå¤§é‡æ•°æ®çš„æ¢¯åº¦ä¸‹é™ï¼Œ è€Œå¯¹äºå°‘é‡çš„æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨æ‰¹é‡æ¢¯åº¦ä¸‹é™å³å¯ã€‚</p>
<h3 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="åå‘ä¼ æ’­"></a>åå‘ä¼ æ’­</h3><p>ä¸€èˆ¬è€Œè¨€ï¼Œç¥ç»ç½‘ç»œéƒ½æ˜¯BPç¥ç»ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯åå‘ä¼ æ’­æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ•…è€Œåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¿æŒå‚æ•°çš„åå‘ä¼ æ’­ï¼ˆèƒ½è®¡ç®—å…¶å¯¼æ•°ï¼‰ï¼Œåœ¨pytorchä¸­ï¼Œç»™å‡ºäº†ç›¸åº”çš„æ–¹æ³•æ¥è¿›è¡Œåå‘ä¼ æ’­ã€‚</p>
<h2 id="softmax-ä¸åˆ†ç±»æ¨¡å‹"><a href="#softmax-ä¸åˆ†ç±»æ¨¡å‹" class="headerlink" title="softmax ä¸åˆ†ç±»æ¨¡å‹"></a>softmax ä¸åˆ†ç±»æ¨¡å‹</h2><h3 id="softmax"><a href="#softmax" class="headerlink" title="softmax"></a>softmax</h3><p>softmaxçš„æå‡ºï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸ºäº†æ•°å€¼è®¡ç®—çš„æ–¹ä¾¿ã€‚å¯¹äºsoftmaxçš„ç†è§£ï¼Œä¸»è¦è¦é€šè¿‡ä¿¡æ¯è®ºå’Œæ•°å€¼è®¡ç®—è¿™ä¸¤æ–¹é¢æ¥è¿›è¡Œï¼Œsoftmaxå‡½æ•°æœ¬èº«æ‰€å…·æœ‰çš„ç‰¹æ€§ï¼Œè®©ä»–èƒ½å¤Ÿå¾ˆå¥½åœ°è¿ç”¨åœ¨åˆ†ç±»ç½‘ç»œä¸­ã€‚</p>
<h3 id="äº¤å‰ç†µ"><a href="#äº¤å‰ç†µ" class="headerlink" title="äº¤å‰ç†µ"></a>äº¤å‰ç†µ</h3><p>å¯¹äºäº¤å‰ç†µï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯ä¿¡æ¯è®ºçš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå…¶æœ¬èº«ç”¨åœ¨åˆ†ç±»æ¨¡å‹ä¸­ï¼Œè¡¨ç¤ºæˆ‘ä»¬åªå…³å¿ƒåˆ†ç±»å‡ºæ¥çš„é‚£ä¸ªç»“æœçš„æ¦‚ç‡æ¯”çš„å¤§å°ï¼Œè€Œä¸åœ¨æ„å…¶å®ƒçš„ç»“æœã€‚</p>
<h2 id="å¤šå±‚æ„ŸçŸ¥æœº"><a href="#å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœº"></a>å¤šå±‚æ„ŸçŸ¥æœº</h2><p>å¤šå±‚æ„ŸçŸ¥æœºå…¶åŸç†å°±æ˜¯é€šè¿‡åœ¨ä¸€å±‚å’Œä¸€å±‚ä¹‹é—´åŠ ä¸Šæ¿€æ´»å‡½æ•°ï¼Œä½¿å¾—æœ¬æ¥å¾ˆç®€å•çš„è¿‡ç¨‹å¯ä»¥æ˜ å°„åˆ°æ›´å¤æ‚çš„ç½‘ç»œç»“æ„å’Œé«˜ç»´çš„æ•°æ®åˆ†å¸ƒç»“æ„å½“ä¸­ã€‚</p>
<h2 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h2><h3 id="ä¸¤ç§ä¸åŒé‡‡æ ·æ–¹å¼ä¸‹çš„å¤„ç†"><a href="#ä¸¤ç§ä¸åŒé‡‡æ ·æ–¹å¼ä¸‹çš„å¤„ç†" class="headerlink" title="ä¸¤ç§ä¸åŒé‡‡æ ·æ–¹å¼ä¸‹çš„å¤„ç†"></a>ä¸¤ç§ä¸åŒé‡‡æ ·æ–¹å¼ä¸‹çš„å¤„ç†</h3><p>åœ¨å®ç°RNN çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> is_random_iter:  <span class="comment"># å¦‚ä½¿ç”¨ç›¸é‚»é‡‡æ ·ï¼Œåœ¨epochå¼€å§‹æ—¶åˆå§‹åŒ–éšè—çŠ¶æ€</span></span><br><span class="line">    state = init_rnn_state(batch_size, num_hiddens, device)</span><br><span class="line">l_sum, n, start = <span class="number">0.0</span>, <span class="number">0</span>, time.time()</span><br><span class="line">data_iter = data_iter_fn(corpus_indices, batch_size, num_steps, device)</span><br><span class="line"><span class="keyword">for</span> X, Y <span class="keyword">in</span> data_iter:</span><br><span class="line">    <span class="keyword">if</span> is_random_iter:  <span class="comment"># å¦‚ä½¿ç”¨éšæœºé‡‡æ ·ï¼Œåœ¨æ¯ä¸ªå°æ‰¹é‡æ›´æ–°å‰åˆå§‹åŒ–éšè—çŠ¶æ€</span></span><br><span class="line">        state = init_rnn_state(batch_size, num_hiddens, device)</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># å¦åˆ™éœ€è¦ä½¿ç”¨detachå‡½æ•°ä»è®¡ç®—å›¾åˆ†ç¦»éšè—çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> state:</span><br><span class="line">            s.detach_()</span><br></pre></td></tr></table></figure>
<p>å¯¹äºä¸¤ç§ä¸åŒçš„é‡‡æ ·æ–¹å¼ï¼Œé‡‡ç”¨äº†ä¸åŒçš„å¯¹äºéšè—çŠ¶æ€H çš„å¤„ç†æ–¹å¼ï¼Œå¯¹æ­¤è¿›è¡Œç†è§£</p>
<h4 id="éšæœºé‡‡æ ·"><a href="#éšæœºé‡‡æ ·" class="headerlink" title="éšæœºé‡‡æ ·"></a>éšæœºé‡‡æ ·</h4><p>å¯¹äºéšæœºé‡‡æ ·ï¼Œç”±äºé‡‡æ ·ç»“æœçš„ä¸è¿ç»­ï¼Œé‚£ä¹ˆä¹‹å‰æ‰€å…·æœ‰çš„çŠ¶æ€Hå¯¹å½“å‰æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ•…éœ€è¦é‡æ–°åˆå§‹åŒ–çŠ¶æ€<code>`init_rnn_state</code>ã€‚</p>
<h4 id="ç›¸é‚»é‡‡æ ·"><a href="#ç›¸é‚»é‡‡æ ·" class="headerlink" title="ç›¸é‚»é‡‡æ ·"></a>ç›¸é‚»é‡‡æ ·</h4><p>åœ¨ç›¸é‚»é‡‡æ ·å¼€å§‹å‰ï¼Œé¦–å…ˆè¿›è¡Œäº†<code>init_rnn_state</code> å‡½æ•°è°ƒç”¨ï¼Œå³è¿›è¡Œäº†ç›¸åº”çš„åˆå§‹åŒ–ã€‚ç”±äºä½¿ç”¨çš„æ˜¯ç›¸é‚»é‡‡æ ·ï¼Œé‚£ä¹ˆæ­£å¦‚ä¾‹å­æ‰€å±•ç¤ºçš„é‚£æ ·ï¼Œå¾—åˆ°çš„æ•°æ®åº”è¯¥æ˜¯ç›¸é‚»è¿ç»­çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">X:  tensor([[ 0,  1,  2,  3,  4,  5],</span><br><span class="line">        [15, 16, 17, 18, 19, 20]]) </span><br><span class="line">Y: tensor([[ 1,  2,  3,  4,  5,  6],</span><br><span class="line">        [16, 17, 18, 19, 20, 21]]) </span><br><span class="line"></span><br><span class="line">X:  tensor([[ 6,  7,  8,  9, 10, 11],</span><br><span class="line">        [21, 22, 23, 24, 25, 26]]) </span><br><span class="line">Y: tensor([[ 7,  8,  9, 10, 11, 12],</span><br><span class="line">        [22, 23, 24, 25, 26, 27]])</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å®é™…ä¸Šï¼Œè¿›è¡Œ<code>data_iter_fn</code>è¿­ä»£çš„æ—¶å€™ï¼Œæ‰€å¾—åˆ°çš„æ•°æ®ï¼Œå³æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆå…¶æœ¬èº«çš„çŠ¶æ€æ˜¯å¯ä»¥ä¿æŒçš„ï¼Œæ­£å¦‚ç”¨[0,1,2,3,4,5]çš„çŠ¶æ€æ¨å‡ºåˆ°[1,2,3,4,5,6]çš„çŠ¶æ€ä¸€æ ·ï¼Œè¿™æ ·çš„è¿‡ç¨‹æ˜¯è¿ç»­è¿›è¡Œçš„ï¼Œæ‰€ä»¥çŠ¶æ€ä¹Ÿåº”è¯¥æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œåº”è¯¥ä¿æŒçŠ¶æ€Hä¸å˜ï¼Œè€Œä¸éœ€è¦åƒéšæœºé‡‡æ ·é‚£æ ·é‡æ–°<code>init_rnn_state</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨detach_æ¥ä¿ç•™å½“å‰Hçš„çŠ¶æ€ï¼Œæ¥è¿›è¡Œåç»­çš„æ¨å¯¼ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>detach_</code>è€Œä¸ç›´æ¥ä¿ç•™å‘¢ï¼Ÿ</p>
<p>å¯ä»¥å‚è§detach_çš„æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># detach_ çš„æºç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detach_</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Detaches the Variable from the graph that created it, making it a</span></span><br><span class="line"><span class="string">    leaf.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self._grad_fn = <span class="keyword">None</span></span><br><span class="line">    self.requires_grad = <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°†å…¶å°† Variable çš„grad_fn è®¾ç½®ä¸º Noneï¼Œè¿™æ ·ï¼ŒBP çš„æ—¶å€™ï¼Œåˆ°è¿™ä¸ª Variable å°±æ‰¾ä¸åˆ° å®ƒçš„ grad_fnï¼Œæ‰€ä»¥å°±ä¸ä¼šå†å¾€åBPäº†ã€‚</p>
<p>å› ä¸ºé‡‡æ ·çš„æ—¶å€™ï¼Œå·²ç»é¢„è®¾äº†ç›¸åº”çš„å‰æï¼Œå³ç¡®å®šçš„æ—¶é—´æ­¥é•¿ï¼Œä¸åº”è¯¥å†å‘å‰BPï¼ˆåå‘ä¼ æ’­ï¼‰ï¼Œæ•…è€Œéœ€è¦å°†å…¶detachæ‰ã€‚</p>
<p>å¯¹äºdetach_å‡½æ•°çš„ç†è§£ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢<a href="https://www.cnblogs.com/jiangkejie/p/9981707.html" target="_blank" rel="noopener">pytorchä¸­çš„detach_å’Œdetach</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/11/01/hello-world/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/01/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-01T19:51:23+08:00">
                2019-11-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/09/25/github&git/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/25/github&git/" itemprop="url">github&git</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-25T19:15:03+08:00">
                2019-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Git-amp-github"><a href="#Git-amp-github" class="headerlink" title="Git &amp; github"></a>Git &amp; github</h1><hr>
<h2 id="github-è´¦å·ç”³è¯·"><a href="#github-è´¦å·ç”³è¯·" class="headerlink" title="github è´¦å·ç”³è¯·"></a>github è´¦å·ç”³è¯·</h2><h3 id="personal-or-workgroup"><a href="#personal-or-workgroup" class="headerlink" title="personal or workgroup"></a>personal or workgroup</h3><ul>
<li>ä¸ªäººè´¦å·æ³¨å†Œ-&gt; ç™»å½•<a href="https://github.com/" target="_blank" rel="noopener">github</a> æ ¹æ®ç›¸å…³ä¿¡æ¯æ³¨å†Œè´¦å·(sign up è¡¨ç¤ºæ³¨å†Œï¼Œsign in è¡¨ç¤ºç™»å½•)</li>
</ul>
<p>å½“éœ€è¦æ³¨å†Œorganizationçš„æ—¶å€™ï¼Œåˆ™å¯ä»¥å¦‚å›¾ï¼Œé€‰æ‹©new organization æ¥åˆ›å»ºä¸€ä¸ªworkgroupã€‚<br><img src="https://github.com/leliyliu/figure_lib/blob/master/loognson/git/organization.png?raw=true" alt="workgourp"></p>
<h3 id="åˆ›å»ºä»“åº“-new-repository"><a href="#åˆ›å»ºä»“åº“-new-repository" class="headerlink" title="åˆ›å»ºä»“åº“(new repository)"></a>åˆ›å»ºä»“åº“(new repository)</h3><p>å…¶ä¸­åŒ…æ‹¬äº†å‡ é¡¹å†…å®¹ï¼Œéœ€è¦å¡«å†™æˆ–è€…é€‰æ‹©ï¼šrepository name , Description, initialization or not , gitignore and license.</p>
<p><img src="https://github.com/leliyliu/figure_lib/blob/master/loognson/git/create.jpg?raw=true" alt="create"><br>é€‰æ‹©clone or download,ç„¶ååœ¨æœ¬åœ°æ‰“å¼€git bash ï¼Œç„¶ågit cloneï¼š</p>
<p><img src="https://github.com/leliyliu/figure_lib/blob/master/loognson/git/clone.jpg?raw=true" alt="clone"></p>
<p><img src="https://github.com/leliyliu/figure_lib/blob/master/loognson/git/gitclone.jpg?raw=true" alt="git_clone"></p>
<h3 id="é…ç½®ç”¨æˆ·åå’Œé‚®ç®±"><a href="#é…ç½®ç”¨æˆ·åå’Œé‚®ç®±" class="headerlink" title="é…ç½®ç”¨æˆ·åå’Œé‚®ç®±"></a>é…ç½®ç”¨æˆ·åå’Œé‚®ç®±</h3><blockquote>
<p>ç¬¬ä¸€æ¬¡ä½¿ç”¨gitBashéœ€è¦é…ç½®é‚®ç®±å’Œç”¨æˆ·åï¼Œé‚®ç®±å¯ä»¥å¡«ä½ è‡ªå·±çš„é‚®ç®±ï¼Œç”¨æˆ·åå¯ä»¥ä»»æ„å†™ï¼Œè¿™ä¸æ˜¯åšç™»å½•ä½¿ç”¨ï¼Œå°±æ˜¯ä¿ç•™è‡ªå·±çš„ä¿¡æ¯è€Œå·²ã€‚</p>
</blockquote>
<ul>
<li>è¾“å…¥git config â€”global user.emailæŒ‰å›è½¦ï¼Œç„¶åè¾“å…¥ä½ çš„é‚®ç®±</li>
<li>è¾“å…¥git config â€”global user.nameæŒ‰å›è½¦ï¼Œç„¶åè¾“å…¥ä½ çš„ç”¨æˆ·å</li>
<li>é‚®ç®±å’Œç”¨æˆ·åéƒ½ä½¿ç”¨ä¹‹åå°±å¯ä»¥æ­£å¼ä½¿ç”¨gitäº†</li>
</ul>
<h3 id="git-å¸¸ç”¨å‘½ä»¤æ±‡æ€»"><a href="#git-å¸¸ç”¨å‘½ä»¤æ±‡æ€»" class="headerlink" title="git å¸¸ç”¨å‘½ä»¤æ±‡æ€»"></a>git å¸¸ç”¨å‘½ä»¤æ±‡æ€»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å…‹éš†ä»£ç ï¼šgit <span class="built_in">clone</span> è¿œç¨‹ä»“åº“çš„url</span><br><span class="line">é…ç½®é‚®ç®±ï¼šgit config --global user.email</span><br><span class="line">é…ç½®ç”¨æˆ·åï¼šgit config --global user.name</span><br><span class="line">ä»è¿œç¨‹ä»“åº“ä¸‹æ‹‰ä»£ç åˆ°æœ¬åœ°ï¼šgit pull</span><br><span class="line">å°†æœ¬åœ°ä»£ç æ·»åŠ åˆ°ç¼“å†²åŒºï¼šgit add * .</span><br><span class="line">å°†æœ¬åœ°ä»£ç æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼šgit commit -m<span class="string">"æ—¥å¿—æ–‡å­—"</span></span><br><span class="line">å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°è¿œç¨‹ä»“åº“ï¼šgit push origin master</span><br><span class="line">æŸ¥çœ‹æ—¥å¿—ï¼šgit <span class="built_in">log</span></span><br><span class="line">æŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„æäº¤æ—¥å¿—ï¼šgit <span class="built_in">log</span> æ–‡ä»¶å</span><br><span class="line">æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æäº¤æ—¥å¿—ï¼šgit <span class="built_in">log</span> --author=â€œauthorâ€</span><br><span class="line">æŸ¥çœ‹æŸæ¡æäº¤æ—¥å¿—ç›¸ä¿¡ä¿¡æ¯ï¼šgit show ç‰ˆæœ¬å·</span><br><span class="line">æŸ¥çœ‹gitå…¨éƒ¨å‘½ä»¤ï¼šgit --<span class="built_in">help</span></span><br><span class="line">æŸ¥çœ‹gitæŸä¸ªå‘½ä»¤çš„ä½¿ç”¨ï¼šgit <span class="built_in">help</span> å‘½ä»¤å</span><br></pre></td></tr></table></figure>
<h3 id="more-commands"><a href="#more-commands" class="headerlink" title="more commands"></a>more commands</h3><p>å‚è€ƒ<a href="https://www.jianshu.com/p/cf1e883d69d6" target="_blank" rel="noopener">Git å‘½ä»¤å¤§å…¨</a></p>
<h4 id="é¡¹ç›®æäº¤å’Œæ‹‰å–"><a href="#é¡¹ç›®æäº¤å’Œæ‹‰å–" class="headerlink" title="é¡¹ç›®æäº¤å’Œæ‹‰å–"></a>é¡¹ç›®æäº¤å’Œæ‹‰å–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// å…‹éš†è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°(å…ˆ<span class="built_in">cd</span>åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹,å†æ‰§è¡Œ<span class="built_in">clone</span>æ“ä½œï¼‰</span><br><span class="line">$ git <span class="built_in">clone</span> git@github.com:leliyliu/augmips.git</span><br><span class="line"></span><br><span class="line">// æ·»åŠ æœ¬åœ°åº“</span><br><span class="line">$ git add ProjectName         --------  <span class="string">"ProjectName"</span>é¡¹ç›®åç§°</span><br><span class="line"></span><br><span class="line">// æ·»åŠ æäº¤æ—¥å¿—</span><br><span class="line">$ git commit -m â€˜Journalâ€™     </span><br><span class="line"></span><br><span class="line">// æäº¤åˆ°è¿œç«¯</span><br><span class="line">$ git push origin master      --------  <span class="string">"master"</span>åˆ†æ”¯å</span><br><span class="line"></span><br><span class="line">// ä»è¿œç«¯æ‹‰å–ä»£</span><br><span class="line">$ git pull origin master</span><br></pre></td></tr></table></figure>
<h4 id="å¸¸ç”¨è¾…åŠ©å‘½ä»¤"><a href="#å¸¸ç”¨è¾…åŠ©å‘½ä»¤" class="headerlink" title="å¸¸ç”¨è¾…åŠ©å‘½ä»¤"></a>å¸¸ç”¨è¾…åŠ©å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// æŸ¥çœ‹æäº¤æ—¥å¿—</span><br><span class="line">$ git <span class="built_in">log</span> -3  --------æŸ¥çœ‹æœ€è¿‘ä¸‰æ¬¡æäº¤çš„è®°å½•</span><br><span class="line"></span><br><span class="line">// æŸ¥çœ‹æ–‡ä»¶æäº¤çŠ¶æ€</span><br><span class="line">$ git status</span><br></pre></td></tr></table></figure>
<h4 id="æ ‡ç­¾æ“ä½œ"><a href="#æ ‡ç­¾æ“ä½œ" class="headerlink" title="æ ‡ç­¾æ“ä½œ"></a>æ ‡ç­¾æ“ä½œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// æ‰“ä¸€ä¸ªæ–°æ ‡ç­¾</span><br><span class="line">$ git tag v1.0.0</span><br><span class="line"></span><br><span class="line">// æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾</span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line">// æ ¹æ®commit id æ‰“æ ‡ç­¾</span><br><span class="line">$ git tag v1.0.1 2fbb88d5fad5a03e5b4ef2df316b4d32f5339ef5</span><br><span class="line"></span><br><span class="line">// åˆ é™¤æ ‡ç­¾</span><br><span class="line">$ git tag -d v1.1.0</span><br></pre></td></tr></table></figure>
<h4 id="å…³äºåˆ†æ”¯"><a href="#å…³äºåˆ†æ”¯" class="headerlink" title="å…³äºåˆ†æ”¯"></a>å…³äºåˆ†æ”¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//1ã€ æŸ¥çœ‹å½“å‰æ‰€æœ‰åˆ†æ”¯</span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># * dev          ---- å½“å‰åˆ†æ”¯</span></span><br><span class="line"><span class="comment">#   master       ---- ä¸»åˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//2ã€ åˆ›å»ºåˆ†æ”¯</span><br><span class="line">$ git branch dev</span><br><span class="line"></span><br><span class="line">//3ã€ åˆ‡æ¢åˆ†æ”¯</span><br><span class="line">$ git checkout dev</span><br><span class="line"></span><br><span class="line">//4ã€ åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ï¼ˆç›¸å½“äºå‰ä¸¤æ­¥æ“ä½œï¼‰</span><br><span class="line">$ git checkout -b dev</span><br><span class="line"></span><br><span class="line">//5.1ã€ åˆå¹¶åˆ†æ”¯</span><br><span class="line">$ git merge dev                 ------ âš ï¸ ï¼ˆæ­¤å‘½ä»¤ä¸ºï¼šåˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼Œä¾‹ï¼šå°†devåˆå¹¶åˆ°masterï¼‰ï¼Œåˆ™å½“å‰æ‰€å¤„äºmasteråˆ†æ”¯ã€‚</span><br><span class="line"></span><br><span class="line">//5.2ã€ åˆå¹¶devåˆ†æ”¯ä¸Šçš„æŸæ¡è®°å½•åˆ°masterä¸Š</span><br><span class="line">//ï¼ˆä¾‹å¦‚ï¼šåœ¨devä¸Šæœ‰ä¸‰æ¬¡æäº¤è®°å½•ï¼Œä½†æ˜¯åªæƒ³æŠŠå…¶ä¸­çš„ç¬¬äºŒæ¬¡åˆå¹¶åˆ°masterä¸Šå»ï¼Œé‡‡å–è¿™ä¸ªå‘½ä»¤ï¼‰</span><br><span class="line">git cherry-pick <span class="string">"ddec59e2..."</span>   ------âš ï¸ åœ¨masteråˆ†æ”¯ä¸‹è¾“å…¥å‘½ä»¤ï¼Œå‚æ•°ä¸º commit-id</span><br><span class="line"></span><br><span class="line">// å¦‚æœåœ¨åˆå¹¶ä¸­å­˜åœ¨ä»¥ä¸‹å†²çªï¼Œè¿›å…¥æ–‡ä»¶å¤¹æ‰‹åŠ¨è§£å†³å†²çªå†æ¬¡æäº¤</span><br><span class="line">hint: after resolving the conflicts, mark the corrected paths</span><br><span class="line">hint: with <span class="string">'git add &lt;paths&gt;'</span> or <span class="string">'git rm &lt;paths&gt;'</span></span><br><span class="line"></span><br><span class="line">//6ã€ åˆ é™¤æŒ‡å®šåˆ†æ”¯</span><br><span class="line">$ git branch -D dev              ------ âš ï¸ï¼ˆä¿è¯å½“å‰åˆ†æ”¯ä¸ºéåˆ é™¤åˆ†æ”¯ï¼‰</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//1ã€ æŸ¥çœ‹å½“å‰æ‰€æœ‰åˆ†æ”¯</span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># * dev          ---- å½“å‰åˆ†æ”¯</span></span><br><span class="line"><span class="comment">#   master       ---- ä¸»åˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//2ã€ åˆ›å»ºåˆ†æ”¯</span><br><span class="line">$ git branch dev</span><br><span class="line"></span><br><span class="line">//3ã€ åˆ‡æ¢åˆ†æ”¯</span><br><span class="line">$ git checkout dev</span><br><span class="line"></span><br><span class="line">//4ã€ åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ï¼ˆç›¸å½“äºå‰ä¸¤æ­¥æ“ä½œï¼‰</span><br><span class="line">$ git checkout -b dev</span><br><span class="line"></span><br><span class="line">//5.1ã€ åˆå¹¶åˆ†æ”¯</span><br><span class="line">$ git merge dev                 ------ âš ï¸ ï¼ˆæ­¤å‘½ä»¤ä¸ºï¼šåˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼Œä¾‹ï¼šå°†devåˆå¹¶åˆ°masterï¼‰ï¼Œåˆ™å½“å‰æ‰€å¤„äºmasteråˆ†æ”¯ã€‚</span><br><span class="line"></span><br><span class="line">//5.2ã€ åˆå¹¶devåˆ†æ”¯ä¸Šçš„æŸæ¡è®°å½•åˆ°masterä¸Š</span><br><span class="line">//ï¼ˆä¾‹å¦‚ï¼šåœ¨devä¸Šæœ‰ä¸‰æ¬¡æäº¤è®°å½•ï¼Œä½†æ˜¯åªæƒ³æŠŠå…¶ä¸­çš„ç¬¬äºŒæ¬¡åˆå¹¶åˆ°masterä¸Šå»ï¼Œé‡‡å–è¿™ä¸ªå‘½ä»¤ï¼‰</span><br><span class="line">git cherry-pick <span class="string">"ddec59e2..."</span>   ------âš ï¸ åœ¨masteråˆ†æ”¯ä¸‹è¾“å…¥å‘½ä»¤ï¼Œå‚æ•°ä¸º commit-id</span><br><span class="line"></span><br><span class="line">// å¦‚æœåœ¨åˆå¹¶ä¸­å­˜åœ¨ä»¥ä¸‹å†²çªï¼Œè¿›å…¥æ–‡ä»¶å¤¹æ‰‹åŠ¨è§£å†³å†²çªå†æ¬¡æäº¤</span><br><span class="line">hint: after resolving the conflicts, mark the corrected paths</span><br><span class="line">hint: with <span class="string">'git add &lt;paths&gt;'</span> or <span class="string">'git rm &lt;paths&gt;'</span></span><br><span class="line"></span><br><span class="line">//6ã€ åˆ é™¤æŒ‡å®šåˆ†æ”¯</span><br><span class="line">$ git branch -D dev              ------ âš ï¸ï¼ˆä¿è¯å½“å‰åˆ†æ”¯ä¸ºéåˆ é™¤åˆ†æ”¯ï¼‰</span><br></pre></td></tr></table></figure>
<h4 id="ç‰ˆæœ¬çš„å›é€€"><a href="#ç‰ˆæœ¬çš„å›é€€" class="headerlink" title="ç‰ˆæœ¬çš„å›é€€"></a>ç‰ˆæœ¬çš„å›é€€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -3</span><br><span class="line"></span><br><span class="line"><span class="comment"># commit 65e19bef8eed336aefedaca636d78e71cea1d4f6 (HEAD -&gt; master, origin/master, origin/HEAD)</span></span><br><span class="line"><span class="comment"># Author: lizhiqiang &lt;601623654@qq.com&gt;</span></span><br><span class="line"><span class="comment"># Date:   Wed Mar 14 15:54:06 2018 +0800</span></span><br><span class="line"></span><br><span class="line">    å¢åŠ 1.1.3ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="comment"># commit 2fbb88d5fad5a03e5b4ef2df316b4d32f5339ef5</span></span><br><span class="line"><span class="comment"># Author: lizhiqiang &lt;601623654@qq.com&gt;</span></span><br><span class="line"><span class="comment"># Date:   Wed Mar 14 15:51:22 2018 +0800</span></span><br><span class="line"></span><br><span class="line">    å¢åŠ 1.1.2ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="comment"># commit aa0f5ce90153c76249a12b8fa638a42b5155612b</span></span><br><span class="line"><span class="comment"># Author: lizhiqiang &lt;601623654@qq.com&gt;</span></span><br><span class="line"><span class="comment"># Date:   Wed Mar 14 15:46:03 2018 +0800</span></span><br><span class="line"></span><br><span class="line">    å¢åŠ 1.1.1ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// é€€å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span><br><span class="line">$ git reset --hard HEAD^</span><br><span class="line"><span class="comment"># HEAD is now at 2fbb88d å¢åŠ 1.1.2ç‰ˆæœ¬    </span></span><br><span class="line">-----åœ¨æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒHEADæŒ‡é’ˆå·²ç»ç”±1.1.3ç‰ˆæœ¬æŒ‡å‘äº†1.1.2ç‰ˆæœ¬ï¼Œå¦‚æœä½ æŠŠxcodeæ‰“å¼€å°±å¯ä»¥çœ‹åˆ°ï¼Œ1.1.3çš„ä»£ç å·²ç»æ¶ˆå¤±äº†</span><br><span class="line">-----å¦‚æœä½ çš„å‘½ä»¤çª—å£æ²¡æœ‰å…³é—­çš„è¯ï¼Œé€šè¿‡commit id è¿˜æ˜¯å¯ä»¥è¿”å›1.1.3çš„,å…·ä½“è¯·çœ‹ä¸‹ä¸€æ¡å‘½ä»¤</span><br><span class="line"></span><br><span class="line">// è¿”å›ä»»æ„ç‰ˆæœ¬</span><br><span class="line">$ git reset --hard 65e19bef8eed336aefedaca636d78e71cea1d4f6</span><br><span class="line"><span class="comment"># HEAD is now at 65e19be å¢åŠ 1.1.3ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">// å°†ä¿®æ”¹åçš„ç‰ˆæœ¬æ¨é€è‡³æœåŠ¡å™¨</span><br><span class="line">$ git push -f -u origin master</span><br></pre></td></tr></table></figure>
<h4 id="é˜¶æ®µçš„æ’¤é”€æ›´æ”¹"><a href="#é˜¶æ®µçš„æ’¤é”€æ›´æ”¹" class="headerlink" title="é˜¶æ®µçš„æ’¤é”€æ›´æ”¹"></a>é˜¶æ®µçš„æ’¤é”€æ›´æ”¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜   ------------æ²¡æœ‰æ‰§è¡Œ git add</span><br><span class="line">$ git checkout .    ï¼ˆæˆ– $ git reset --hardï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å·²æš‚å­˜ï¼Œæœªæäº¤   ------------ä½ å·²ç»æ‰§è¡Œäº† git add . ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œ git commit -m <span class="string">"comment"</span> ã€‚</span><br><span class="line">$ git reset</span><br><span class="line">$ git checkout .     (æˆ– $ git reset --hard)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å·²æäº¤ï¼Œæœªæ¨é€   ------------æ—¢æ‰§è¡Œäº† git add . ï¼Œåˆæ‰§è¡Œäº† git commit </span><br><span class="line">$ git reset --hard origin/master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å·²æ¨é€          ------------æ—¢ git add äº†ï¼Œåˆ git commit äº†ï¼Œå¹¶ä¸”è¿˜ git push äº†</span><br><span class="line">$ git reset --hard HEAD^</span><br><span class="line">$ git push -f</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/05/05/django-learning/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/05/django-learning/" itemprop="url">django_learning</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-05T14:56:16+08:00">
                2019-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/05/05/paper-reading/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/05/paper-reading/" itemprop="url">paper_reading</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-05T08:07:26+08:00">
                2019-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Neural-Collaborative-Filtering"><a href="#Neural-Collaborative-Filtering" class="headerlink" title="Neural Collaborative Filtering"></a>Neural Collaborative Filtering</h1><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†æ·±åº¦å­¦ä¹ åœ¨æ¨èç³»ç»Ÿæ–¹é¢çš„åº”ç”¨ï¼Œä¸»è¦æ˜¯åº”ç”¨äº†ç¥ç»ç½‘ç»œæ­å»ºååŒè¿‡æ»¤çš„ç½‘ç»œï¼Œå½¢æˆä¸€ä¸ªè¾ƒå¥½çš„ç»“æœã€‚</p>
<p>æˆ‘å°†ç»“åˆæ–‡ç« ä¸­æ‰€æåŠçš„ä¸»è¦æ–¹æ³•åŠå…¶ä»£ç æ¥å›é¡¾æ•´ç¯‡æ–‡ç« ã€‚</p>
<h2 id="3-NEURAL-COLLABORATIVE-FILTERING"><a href="#3-NEURAL-COLLABORATIVE-FILTERING" class="headerlink" title="3. NEURAL COLLABORATIVE FILTERING"></a>3. NEURAL COLLABORATIVE FILTERING</h2><p>ä»ç¬¬ä¸‰éƒ¨åˆ†æ‰æ¥åˆ°å®è·µçš„å…³é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è·³è¿‡å‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¥åˆ°ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œå­¦ä¹ å’Œç†è§£ã€‚è®ºæ–‡çš„ä¸»è¦éƒ¨åˆ†åœ¨äºï¼Œé¦–å…ˆå®ç°NCFï¼Œå¹¶å¯¹äºNCFå®ä¾‹åŒ–ä¹‹ååˆ©ç”¨DNNå¯¹å…¶è¿›è¡Œæ”¹å–„ï¼Œæå‡ºäº†MLPï¼Œç„¶åç»“åˆNCFå’ŒMLPæ¥ç»¼åˆå½¢æˆæœ€åçš„ç»“æœã€‚</p>
<h3 id="GMF"><a href="#GMF" class="headerlink" title="GMF"></a>GMF</h3><p>é¦–å…ˆçš„inputå±‚æ˜¯ä¸€ä¸ªone-hotå‘é‡ï¼Œå°†æ¯ä¸€ä¸ªuserå’Œæ¯ä¸€ä¸ªiteméƒ½è®¾ç½®ä¸ºone-hotå‘é‡ä¹‹åå†è¿›è¡Œå¤„ç†ã€‚åœ¨input å±‚ä¹‹åæ˜¯ä¸€ä¸ªembedding å±‚ï¼Œç„¶åå°†itemå’Œuser çš„embeddingå±‚ çš„ç»“æœåˆåœ¨ä¸€èµ·ä¹‹åæ”¾å…¥ä¸€ä¸ªå¤šå±‚ç¥ç»ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå¤šå±‚çš„ç¥ç»ç½‘ç»œè§†ä½œç¥ç»ååŒè¿‡æ»¤å±‚ï¼Œéšè—å±‚çš„æœ€åä¸€å±‚çš„ç»´åº¦å†³å®šäº†è¿™ä¸ªæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æœ€ç»ˆçš„è¾“å‡ºå±‚(output)å¾—åˆ°çš„æ˜¯æœ€ç»ˆé¢„æµ‹çš„ç»“æœã€‚</p>
<h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>å…³äºrange å’Œ xrangeï¼Œå¦‚æœåªçœ‹æ•ˆæœçš„è¯ï¼Œä¸¤è€…å·®è·å¾ˆå°ï¼Œä½†æ˜¯xrangeæ¯æ¬¡è¿”å›çš„æ˜¯xrange çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯rangeè¿”å›çš„listï¼Œå› æ­¤ï¼Œå½“å¯¹äºå¤§æ•°æ®è¿›è¡Œå¤„ç†æ—¶ï¼Œå»ºè®®ä½¿ç”¨xrangeï¼Œè€Œä¸æ˜¯rangeã€‚</p>
<p>å…³äºä»£ç ä¸­çš„å‚æ•°è¯´æ˜ï¼š<br>| ç¬¦å·| å«ä¹‰|<br>| â€”- | â€”- |<br>| num_factors|å°†å…¶æ˜ å°„åˆ°çš„ç©ºé—´çš„ç»´åº¦å¤§å°|<br>|regs|å³æ­£åˆ™åŒ–è¿‡ç¨‹ä¸­çš„åç§»é‡|<br>|num_neg|å±•ç¤ºçš„negtiveæ•°é‡|<br>|lr|å­¦ä¹ ç‡|<br>|learner|å­¦ä¹ çš„æ–¹å¼ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨adam|<br>|verbose|å®è´¨ä¸Šæ˜¯è®¾ç½®å¤šå°‘æ¬¡è¿­ä»£åè¾“å‡ºç»“æœ|<br>|out| è®¾ç½®è¾“å‡º|<br>|epochs| è¿­ä»£æ¬¡æ•°ï¼ˆå­¦ä¹ æ¬¡æ•°ï¼‰|<br>|batch_size|æ¯ä¸€ä¸ªbatchçš„æ•°é‡ï¼Œä½¿ç”¨sgdè¿›è¡Œè®­ç»ƒæ—¶éœ€è¦å¼„æ¸…æ¥š|</p>
<p>é‡ç‚¹çœ‹modelå‡½æ•°ï¼Œå³è®­ç»ƒçš„å‡½æ•°ã€‚<br>è¿™é‡Œçš„æ¨¡å‹æå…¶ç®€å•ï¼Œå®é™…ä¸ŠåŠ æ·±æ¨¡å‹ï¼Œåº”è¯¥æœ‰åŠ©äºæœ€åçš„è®­ç»ƒç»“æœã€‚åŠ æ·±åº”è¯¥åœ¨å“ªé‡Œå‘¢ï¼Ÿä»predict_vectorå¼€å§‹ï¼Œå¤šåŠ å…¥å‡ å±‚ï¼ŒåŒæ—¶åº”è¯¥è€ƒè™‘ä¸è¦ç¤¾ä¼šå¤ªå°‘çš„latent_dimï¼Œæ¯•ç«Ÿæ˜¯å¤§æ•°æ®é‡çš„ç»“æœï¼Œè€ƒè™‘å°†å…¶åŠ æ·±ã€‚åŸæ–‡ä¸­ä¸»è¦æ˜¯ä¸ºäº†èƒ½ä½¿å¾—CPUè¾ƒå¿«çš„è¿è¡Œï¼Œæ‰ä½¿ç”¨äº†è¿™æ ·ä¸€ç§æ–¹å¼ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(num_users, num_items, latent_dim, regs=[<span class="number">0</span>,<span class="number">0</span>])</span>:</span></span><br><span class="line">    <span class="comment"># Input variables</span></span><br><span class="line">    user_input = Input(shape=(<span class="number">1</span>,), dtype=<span class="string">'int32'</span>, name = <span class="string">'user_input'</span>)</span><br><span class="line">    item_input = Input(shape=(<span class="number">1</span>,), dtype=<span class="string">'int32'</span>, name = <span class="string">'item_input'</span>)</span><br><span class="line"></span><br><span class="line">    MF_Embedding_User = Embedding(input_dim = num_users, output_dim = latent_dim, name = <span class="string">'user_embedding'</span>,</span><br><span class="line">                                  init = init_normal, W_regularizer = l2(regs[<span class="number">0</span>]), input_length=<span class="number">1</span>)</span><br><span class="line">    MF_Embedding_Item = Embedding(input_dim = num_items, output_dim = latent_dim, name = <span class="string">'item_embedding'</span>,</span><br><span class="line">                                  init = init_normal, W_regularizer = l2(regs[<span class="number">1</span>]), input_length=<span class="number">1</span>)   </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Crucial to flatten an embedding vector!</span></span><br><span class="line">    user_latent = Flatten()(MF_Embedding_User(user_input))</span><br><span class="line">    item_latent = Flatten()(MF_Embedding_Item(item_input))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Element-wise product of user and item embeddings </span></span><br><span class="line">    predict_vector = merge([user_latent, item_latent], mode = <span class="string">'mul'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Final prediction layer</span></span><br><span class="line">    <span class="comment">#prediction = Lambda(lambda x: K.sigmoid(K.sum(x)), output_shape=(1,))(predict_vector)</span></span><br><span class="line">    prediction = Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>, init=<span class="string">'lecun_uniform'</span>, name = <span class="string">'prediction'</span>)(predict_vector)</span><br><span class="line">    </span><br><span class="line">    model = Model(input=[user_input, item_input], </span><br><span class="line">                output=prediction)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure></p>
<p>get_train_instanceså‡½æ•°å°†è®­ç»ƒé›†ä¼ å…¥å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œæ„æˆone-hotå‘é‡ã€‚<br>ä½†æ˜¯å®é™…ä¸Šè¿™é‡Œçš„labelåªæ˜¯ç”¨äºè®ºæ–‡ä¸­æ‰€è¯´çš„æ˜¯å¦è¿›è¡Œç‚¹å‡»ï¼Œå¯¹äºåç»­çš„æ“ä½œçš„æ„ä¹‰ä¸å¤§ã€‚éœ€è¦æ³¨æ„è¿™é‡Œçš„åŒºåˆ«ã€‚å®é™…ä¸Šï¼Œå¦‚æœçœŸæ­£éœ€è¦åšè¯„åˆ†ç³»ç»Ÿçš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†labelå®šä¹‰ä¸ºæ‰“åˆ†çš„ç»“æœï¼Œè€Œä¸æ˜¯0,1çš„äºŒå€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_train_instances</span><span class="params">(train, num_negatives)</span>:</span></span><br><span class="line">    user_input, item_input, labels = [],[],[]</span><br><span class="line">    num_users = train.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (u, i) <span class="keyword">in</span> train.keys():</span><br><span class="line">        <span class="comment"># positive instance</span></span><br><span class="line">        user_input.append(u)</span><br><span class="line">        item_input.append(i)</span><br><span class="line">        labels.append(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># negative instances</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> xrange(num_negatives):</span><br><span class="line">            j = np.random.randint(num_items)<span class="comment">#ä»0åˆ°item_numçš„æ•°é‡ä¸­é€‰æ‹©ä¸€ä¸ª</span></span><br><span class="line">            <span class="keyword">while</span> train.has_key((u, j)):</span><br><span class="line">                j = np.random.randint(num_items)</span><br><span class="line">            user_input.append(u)</span><br><span class="line">            item_input.append(j)</span><br><span class="line">            labels.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> user_input, item_input, labels</span><br></pre></td></tr></table></figure>
<p>è‡ªå·±çš„å°è¯•ï¼Œä¸»è¦ç”¨äºå¤§æ•°æ®ä½œä¸šçš„æ•°æ®é›†ï¼Œç®€è¦ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ•°æ®é›†ï¼š</p>
<ol>
<li>å¤§æ¦‚æœ‰20000ä¸ªç”¨æˆ·å’Œ600000ä¸ªitemï¼ŒåŒæ—¶ï¼Œæ€»å…±æœ‰5000000æ¡çš„æ‰“åˆ†ï¼Œæ‰“åˆ†ä»0-100ï¼Œä½†æ˜¯åˆ†å¸ƒæå…¶ä¸å‡åŒ€ï¼Œå› æ­¤ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œä¸ºäº†é¿å…ä¸ç¨€ç–çŸ©é˜µçš„é‡åˆï¼Œå°†scoreå˜ä¸º:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">score=np.floor(score/<span class="number">10</span>)+<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å› æ­¤ï¼Œæ„å»ºçš„æ¨¡å‹ä¸º<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(num_users, num_items, latent_dim=<span class="number">100</span>, regs=[<span class="number">0</span>,<span class="number">0</span>])</span>:</span></span><br><span class="line">    <span class="comment"># Input variables</span></span><br><span class="line">    user_input = Input(shape=(<span class="number">1</span>,), dtype=<span class="string">'int32'</span>, name = <span class="string">'user_input'</span>)</span><br><span class="line">    item_input = Input(shape=(<span class="number">1</span>,), dtype=<span class="string">'int32'</span>, name = <span class="string">'item_input'</span>)</span><br><span class="line"></span><br><span class="line">    MF_Embedding_User = Embedding(input_dim = num_users, output_dim = latent_dim, name = <span class="string">'user_embedding'</span>,</span><br><span class="line">                                  init = <span class="string">'uniform'</span>, W_regularizer = l2(regs[<span class="number">0</span>]), input_length=<span class="number">1</span>)</span><br><span class="line">    MF_Embedding_Item = Embedding(input_dim = num_items, output_dim = latent_dim, name = <span class="string">'item_embedding'</span>,</span><br><span class="line">                                  init = <span class="string">'uniform'</span>, W_regularizer = l2(regs[<span class="number">1</span>]), input_length=<span class="number">1</span>)   </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Crucial to flatten an embedding vector!</span></span><br><span class="line">    user_latent = Flatten()(MF_Embedding_User(user_input))</span><br><span class="line">    item_latent = Flatten()(MF_Embedding_Item(item_input))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Element-wise product of user and item embeddings </span></span><br><span class="line">    <span class="comment">#predict_vector = merge([user_latent, item_latent], mode = 'mul')</span></span><br><span class="line">    predict_vector = keras.layers.Multiply()([user_latent,item_latent])</span><br><span class="line">    <span class="comment"># Final prediction layer</span></span><br><span class="line">    <span class="comment">#prediction = Lambda(lambda x: K.sigmoid(K.sum(x)), output_shape=(1,))(predict_vector)</span></span><br><span class="line">    predict_layer1=Dense(<span class="number">64</span>,activation=<span class="string">'sigmoid'</span>,init=<span class="string">'lecun_uniform'</span>,name=<span class="string">'predict_layer1'</span>)(predict_vector)</span><br><span class="line">    predict_layer2=Dense(<span class="number">32</span>,activation=<span class="string">'sigmoid'</span>,init=<span class="string">'lecun_uniform'</span>,name=<span class="string">'predict_layer2'</span>)(predict_layer1)</span><br><span class="line">    prediction = Dense(<span class="number">11</span>, activation=<span class="string">'softmax'</span>, init=<span class="string">'lecun_uniform'</span>, name = <span class="string">'prediction'</span>)(predict_layer2)</span><br><span class="line">    </span><br><span class="line">    model = Model(input=[user_input, item_input], </span><br><span class="line">                output=prediction)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure></p>
<p>ä¸­é—´å¤šåŠ äº†å‡ å±‚ï¼Œå¯¹äºæŠ¥é”™å¤„çš„è®°å½•</p>
<blockquote>
<p>â€˜Denseâ€™ object has no attribute â€˜outbound_nodesâ€™</p>
</blockquote>
<h3 id="MLP"><a href="#MLP" class="headerlink" title="MLP"></a>MLP</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/05/04/colab/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/04/colab/" itemprop="url">colab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-04T17:10:58+08:00">
                2019-05-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Colabçš„ä½¿ç”¨"><a href="#Colabçš„ä½¿ç”¨" class="headerlink" title="Colabçš„ä½¿ç”¨"></a>Colabçš„ä½¿ç”¨</h1><hr>
<h2 id="Colabä»‹ç»"><a href="#Colabä»‹ç»" class="headerlink" title="Colabä»‹ç»"></a>Colabä»‹ç»</h2><p>å¥½ä¸œè¥¿ï¼ï¼ è´«ç©·çš„äººæ°‘ï¼Œæƒ³æ‹¥æœ‰GPUæˆ–è€…TPUçš„éš¾å¾—çš„æ–¹å¼<br>å¯¹äºä¸€äº›åŸºç¡€çš„ä¸œè¥¿ï¼Œéƒ½ä¸åŠ ä»¥ä»‹ç»äº†ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªå·±å»æŸ¥ä¸€ä¸‹ï¼Œæˆ–è€…ucadityçš„tensorflowæ•™ç¨‹é‡Œé¢å°±è¦ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œç›´æ¥è§†é¢‘è§‚çœ‹å³å¯ã€‚<br>è¿™é‡Œç›´æ¥è®°å½•é…ç½®æ–¹å¼</p>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>é¦–å…ˆé€‰æ‹©ä¿®æ”¹ï¼Œæ”¹ä¸ºGPUæˆ–è€…TPU</p>
<p>ç„¶åæ·»åŠ å¦‚ä¸‹ä»£ç åæ‰§è¡Œ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">!apt-get install -y -qq software-properties-common python-software-properties module-init-tools</span><br><span class="line">!add-apt-repository -y ppa:alessandro-strada/ppa <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null</span><br><span class="line">!apt-get update -qq <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null</span><br><span class="line">!apt-get -y install -qq google-drive-ocamlfuse fuse</span><br><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> auth</span><br><span class="line">auth.authenticate_user()</span><br><span class="line"><span class="keyword">from</span> oauth2client.client <span class="keyword">import</span> GoogleCredentials</span><br><span class="line">creds = GoogleCredentials.get_application_default()</span><br><span class="line"><span class="keyword">import</span> getpass</span><br><span class="line">!google-drive-ocamlfuse -headless -id=&#123;creds.client_id&#125; -secret=&#123;creds.client_secret&#125; &lt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep URL</span><br><span class="line">vcode = getpass.getpass()</span><br><span class="line">!echo &#123;vcode&#125; | google-drive-ocamlfuse -headless -id=&#123;creds.client_id&#125; -secret=&#123;creds.client_secret&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæŒ‚è½½<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!mkdir -p drive</span><br><span class="line">!google-drive-ocamlfuse drive</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœéœ€è¦å®‰è£…åŒ…çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install http://download.pytorch.org/whl/cu80/torch<span class="number">-0.3</span><span class="number">.1</span>-cp36-cp36m-linux_x86_64.whl torchvision</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å®‰è£…å°±okäº†</p>
<p>å½“ç„¶åœ¨æ‰§è¡Œä¹‹å‰è¿˜éœ€è¦æ›´æ”¹ç›®å½•ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(<span class="string">'drive/.../...'</span>)<span class="comment">#è¿›å…¥ä½ å¸Œæœ›è¿›å…¥çš„ç›®å½•</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/04/28/reading1/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/28/reading1/" itemprop="url">BTS-DSN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-28T18:59:18+08:00">
                2019-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Paper-Reading"><a href="#Paper-Reading" class="headerlink" title="Paper Reading"></a>Paper Reading</h1><h2 id="BTS-DSN-Deeply-supervised-neural-network-with-short-connections-forretinal-vessel-segmentation"><a href="#BTS-DSN-Deeply-supervised-neural-network-with-short-connections-forretinal-vessel-segmentation" class="headerlink" title="BTS-DSN: Deeply supervised neural network with short connections forretinal vessel segmentation"></a>BTS-DSN: Deeply supervised neural network with short connections forretinal vessel segmentation</h2><hr>
<blockquote>
<p><code>references</code>: you can read this papar via <a href="https://linkinghub.elsevier.com/retrieve/pii/S138650561831195X" target="_blank" rel="noopener">BTS-DSN</a> or star/fork this github <a href="https://github.com/guomugong/BTS-DSN" target="_blank" rel="noopener">project</a></p>
</blockquote>
<h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><ol>
<li>An important method was proposed by this group called short-connection, that improve quite a lot the result of this modelâ€™s ability. They use sensitivity,specificity, AUC and F1-score to test their model. If you arenâ€™t familiar with these indicators, you can read these two blogs to learn more<a href="https://tracholar.github.io/machine-learning/2018/01/26/auc.html" target="_blank" rel="noopener">AUC</a>  &amp;<a href="https://blog.csdn.net/u013385925/article/details/80385873" target="_blank" rel="noopener">AUC-2</a>. </li>
</ol>
<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h3><ol>
<li>why we hope to achieve early dignosis.</li>
<li>some researchs done by other scholar group<blockquote>
<p>(1) Unsupervised methods: some methods have been proposed by scholoars, mainly about detect the profile and contour of vessel. These methods are mostly based on geometric computation model. defects: <code>However, the unsupervised methods are sensitive to the
manually designed features and rules.</code>(poor in generalization)</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>(2)supervised methods:when we use supervised method, we usually view this problem as a pixel-wise binary classification. deep learning methods are popular in this area. Other ways to solve this problem about semantic segmentation results. <code>defects:different methods have different disadvantages such as time-consuming and so on</code></p>
</blockquote>
<ol>
<li>the contributions of this paper<blockquote>
<p>(1)â€We propose a deeply-supervised fully convolutional neural network with bottom-top and top-bottom short connections (BTS-DSN) for vessel segmentation. â€œ</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>(2)â€We used VGGNet and ResNet-101 as backbone and conducted extensive experiments on DRIVE, STARE and CHASE_DB1â€</p>
<p>â€œWe employed cross-training experiments to show the generalization of BTS-DSN.â€</p>
</blockquote>
<p>attributes : more about VGGNet and ResNet can be found in their papers.{<a href="https://github.com/machrisaa/tensorflow-vgg" target="_blank" rel="noopener">vgg(including vgg-16&amp;vgg-19)</a>&amp;<a href="https://arxiv.org/abs/1512.03385" target="_blank" rel="noopener">ResNet_paper</a>&amp;<a href="https://github.com/tensorflow/models/blob/master/research/slim/nets/resnet_v2.py" target="_blank" rel="noopener">ResNet_github</a>}.If you want to understand these model better, baidu or google it may help you.</p>
<h3 id="2-BTS-DSN"><a href="#2-BTS-DSN" class="headerlink" title="2.BTS-DSN"></a>2.BTS-DSN</h3><ol>
<li><p>from HED to DSN, and then to BS-DSN and BST-DSN. this method was proposed to alleviate the gradient vanish problem in deep network. Itâ€™s a deep supervision</p>
</li>
<li><p>bottom-top short connnections: pass low level fine semantic information to high levels to alleviate the blurring situation.</p>
</li>
<li><p>top-bottom short connection: Bottom-top short connections aim to refine high-level segmentation results.</p>
</li>
<li><p>inference: do feature confusion</p>
</li>
</ol>
<h3 id="3-Implementation-details"><a href="#3-Implementation-details" class="headerlink" title="3. Implementation details"></a>3. Implementation details</h3><ol>
<li><p>data augmentation: using quite a lot various transformations to augment the training set, including rotation, flipping and scaling. </p>
</li>
<li><p>model implementation : using the network framework Caffe, short connections of the BTS-DSN. </p>
</li>
<li><p>Parameter settings</p>
</li>
</ol>
<p><code>When the backbone is VGGNet, we fine-tuned our network with a
learning rate of 1e-8, a weight decay of 0.0005, and a momentum of
0.9. We use a fixed learning rate.</code></p>
<p>in two different backbone(VGGNet &amp; ResNet-101),they use different type of parameters . </p>
<p>and for patch-level S-DSN, they split a raw retinal image into 9 patches, each of which was 1/4 the size of the raw image, meanwhile, patches were up-sampled $2 \times$ </p>
<p>4.running environment:â€¦â€¦</p>
<h4 id="Evaluation-criteria"><a href="#Evaluation-criteria" class="headerlink" title="Evaluation criteria"></a>Evaluation criteria</h4><p><code>In vessel segmentation, each pixel belongs to a vessel or non-vessel
pixel.</code>(be seen as a binary classfication problem).they iemployed six evaluation criteria, including AUC,SE,SP,ACC,F1-score and MCC.</p>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p>the result are shown in the fig in this paper, so you can just look through and get them.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>è¿™ç¯‡æ–‡ç« æˆåŠŸå®ç°äº†ç›®å‰åŸºæœ¬ä¸Šæ˜¯æœ€é«˜æ°´å¹³çš„çœ¼åº•è¡€ç®¡åˆ†ç±»æˆæœï¼Œå…¶ä½¿ç”¨VGGNetæˆ–è€…ResNet-101ä½œä¸ºæ”¯æŸ±(backbone)æ¥å®ç°æ•´ä¸ªCNNå·ç§¯çš„è¿‡ç¨‹ï¼ŒåŒæ—¶ï¼Œä¸ºäº†ç¼“è§£è¯­ä¹‰åˆ†å‰²ä¸­è¯­ä¹‰åˆ†å‰²ä¹‹é—´çš„å·®è·ï¼Œä½¿ç”¨top-bottom å’Œ bottom-top short connectionæ¥å®ç°æ•´ä¸ªè¿‡ç¨‹ï¼Œæœ€ç»ˆå®ç°äº†BTS-DSNç½‘ç»œï¼Œè¾¾åˆ°äº†å¥½çš„æ•ˆæœã€‚åŒæ—¶ï¼Œè¿™ä¸ªç½‘ç»œä¹Ÿä½¿ç”¨äº†ç‰¹å¾èåˆçš„æ–¹æ³•ï¼Œå¯ä»¥åŠ ä»¥äº†è§£ã€‚å¯¹äºæ›´å¤šçš„ç»†èŠ‚ï¼Œè¿˜éœ€è¦ç»§ç»­äº†è§£ã€‚</p>
<h3 id="å‘æ•£"><a href="#å‘æ•£" class="headerlink" title="å‘æ•£"></a>å‘æ•£</h3><h4 id="ï¼ˆé‡‡æ ·æ–¹æ³•ï¼‰ä¸Šé‡‡æ ·ä¸ä¸‹é‡‡æ ·"><a href="#ï¼ˆé‡‡æ ·æ–¹æ³•ï¼‰ä¸Šé‡‡æ ·ä¸ä¸‹é‡‡æ ·" class="headerlink" title="ï¼ˆé‡‡æ ·æ–¹æ³•ï¼‰ä¸Šé‡‡æ ·ä¸ä¸‹é‡‡æ ·"></a>ï¼ˆé‡‡æ ·æ–¹æ³•ï¼‰ä¸Šé‡‡æ ·ä¸ä¸‹é‡‡æ ·</h4><h4 id="çŸ­è¿æ¥ä¸ResNetè¿æ¥æ–¹å¼çš„ä¸åŒ"><a href="#çŸ­è¿æ¥ä¸ResNetè¿æ¥æ–¹å¼çš„ä¸åŒ" class="headerlink" title="çŸ­è¿æ¥ä¸ResNetè¿æ¥æ–¹å¼çš„ä¸åŒ"></a>çŸ­è¿æ¥ä¸ResNetè¿æ¥æ–¹å¼çš„ä¸åŒ</h4><h4 id="è¯„ä¼°æ–¹æ³•"><a href="#è¯„ä¼°æ–¹æ³•" class="headerlink" title="è¯„ä¼°æ–¹æ³•"></a>è¯„ä¼°æ–¹æ³•</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leliyliu.github.io/2019/04/28/recording2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leliyliu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¦¾å£°">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/28/recording2/" itemprop="url">AlexNet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-28T18:59:18+08:00">
                2019-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Paper-Reading"><a href="#Paper-Reading" class="headerlink" title="Paper Reading"></a>Paper Reading</h1><h2 id="ImageNet-Classification-with-Deep-Convolutional-Neural-Networks"><a href="#ImageNet-Classification-with-Deep-Convolutional-Neural-Networks" class="headerlink" title="ImageNet Classification with Deep Convolutional Neural Networks"></a>ImageNet Classification with Deep Convolutional Neural Networks</h2><hr>
<blockquote>
<p><code>references</code>: you can read this papar via <a href="https://linkinghub.elsevier.com/retrieve/pii/S138650561831195X" target="_blank" rel="noopener">BTS-DSN</a> or star/fork this github <a href="https://github.com/guomugong/BTS-DSN" target="_blank" rel="noopener">project</a></p>
</blockquote>
<h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><p>To achieve a great result, using ImageNet LSVRC-2010 contest dataset, this network model ,including dropout and some other operations, is quite fancy.</p>
<h3 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1.Introduction"></a>1.Introduction</h3><ol>
<li><p>machine learning methods have achieved great result on small image dataset, but still been poor in big dataset.</p>
</li>
<li><p><code>To learn about thousands of objects from millions of images, we need a model with a large learning
capacity.</code></p>
</li>
</ol>
<h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p><code>ImageNet is a dataset of over 15 million labeled high-resolution images belonging to roughly 22,000
categories.</code><br>to show which dataset this paper trained to test its result.</p>
<h3 id="3-The-Architecture"><a href="#3-The-Architecture" class="headerlink" title="3.The Architecture!!!"></a>3.The Architecture!!!</h3><h4 id="1-ReLU-Nonlinearity"><a href="#1-ReLU-Nonlinearity" class="headerlink" title="1.ReLU Nonlinearity"></a>1.ReLU Nonlinearity</h4><p>why we use ReLU instead of sigmoid or tanh function?<br><code>In terms of training time
with gradient descent, these saturating nonlinearities
are much slower than the non-saturating nonlinearity
f(x) = max(0, x).</code></p>
<blockquote>
<p>ps : å½“æˆ‘ä»¬ä½¿ç”¨ReLUå‡½æ•°è€Œä¸æ˜¯sigmoidæˆ–è€…tanhå‡½æ•°è¿›è¡Œæ¿€æ´»æ—¶ï¼Œä¸»è¦åŸå› åœ¨äºå…¶æ›´å¿«çš„é€Ÿåº¦ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Leaky ReLUç”šè‡³Randomized Leaky ReLUæ¥é˜²æ­¢å…¶å®ƒä¸€äº›é—®é¢˜ã€‚è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„å˜ä½“ï¼ŒåŒ…æ‹¬PReLUå’ŒRReLUã€‚</p>
</blockquote>
<h4 id="2-Training-on-Multiple-GPUs"><a href="#2-Training-on-Multiple-GPUs" class="headerlink" title="2.Training on Multiple GPUs"></a>2.Training on Multiple GPUs</h4><p><code>Current GPUs
are particularly well-suited to cross-GPU parallelization, as they are able to read from and write to
one anotherâ€™s memory directly, without going through host machine memory.</code>using a method to parallel the training process.Notice the parallelization scheme that is employed in this paper, which are quite inspirsed. </p>
<blockquote>
<p>ps : åœ¨åˆ©ç”¨å¤šä¸ªGPUè¿›è¡Œå¹¶è¡Œå¤„ç†çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’ä¸äº¤äº’ã€‚å¦‚ä½•æé«˜æ•°æ®ä¹‹é—´ä¼ è¾“çš„æ•ˆç‡ï¼Œæ˜¯èƒ½å¤Ÿæé«˜è®¡ç®—é€Ÿåº¦çš„å…³é”®ã€‚</p>
</blockquote>
<h4 id="3-Local-Response-Normalization"><a href="#3-Local-Response-Normalization" class="headerlink" title="3.Local Response Normalization"></a>3.Local Response Normalization</h4><p>using local normalization to aid generation.</p>
<script type="math/tex; mode=display">b_{x,y}^i=a_{x,y}^i/(k+\alpha \sum_{j=max(0,i-n/2)}^{min(N-1,i+n/2)}(a_{x,y}^i)^2)^\beta</script><blockquote>
<p>ps : è¿™ä¸€å°èŠ‚ä¸»è¦è®²è§£äº†è¿™ä¸ªnormalizationçš„æ–¹å¼ï¼Œè¿™ä¸ªå…¬å¼çš„ç»“æœå±•ç¤ºå‡ºæ¥çš„æ•ˆæœåœ¨äºï¼Œæé«˜æ³›åŒ–èƒ½åŠ›ï¼ˆå³bèƒ½æ›´å¥½åœ°ä»£è¡¨ä¸€ä¸ªè¿ç»­æ€§çš„ç»“æœï¼‰ç®€å•åˆ†æä¸‰ä¸ªè¶…å‚æ•°,kä¸ºä¸€ä¸ªåç§»é‡ï¼Œä½¿å¾—æœ¬èº«æœ‰ä¸€ä¸ªåç§»ï¼›nåœ¨äºè€ƒè™‘å…¶è¿ç»­çš„èŒƒå›´ï¼Œè€ƒè™‘æ³›åŒ–èƒ½åŠ›ï¼Œåœ¨äºä¸€ä¸ªæƒè¡¡ï¼Œ$<br>\beta$åœ¨äºè°ƒæ•´å‚æ•°çš„å¤§å°ï¼Œä½¿å¾—ä¸æ¨¡å‹å¥‘åˆã€‚</p>
</blockquote>
<h4 id="4-Overlapping-Pooling"><a href="#4-Overlapping-Pooling" class="headerlink" title="4. Overlapping Pooling"></a>4. Overlapping Pooling</h4><p>using overlapping can make our pooling result more precise than non-overlapping.<code>We generally observe during training that models with overlapping
pooling find it slightly more difficult to overfit</code> </p>
<blockquote>
<p>ps : æˆ‘ä»¬åº”è¯¥æ³¨æ„ä¸€ä¸ªoverlapping ä¸ non-overlappingä¹‹é—´çš„å¹³è¡¡ï¼Œå»ºè®®æ˜¯é¦–å…ˆä¸ç”¨overlappingï¼Œå¦‚æœå¾—åˆ°çš„ç»“æœå¤„äºæ¬ æ‹ŸåˆçŠ¶æ€ï¼Œåˆ™ä¿®æ”¹è€Œä½¿ç”¨overlapping pooling</p>
</blockquote>
<h4 id="5-Overall-Architecture"><a href="#5-Overall-Architecture" class="headerlink" title="5. Overall Architecture"></a>5. Overall Architecture</h4><p>the overall architecture will be shown in figure 1 below.</p>
<blockquote>
<p>ps : ä¸»è¦ç†è§£è¿™ä¸ªç»“æ„ä¸€äº›ä¸­é—´çš„éƒ¨åˆ†ï¼Œéœ€è¦æŒæ¡å¯¹å…¶çš„ç†è§£å¹¶ä¸”ä¸å‰é¢çš„ç›¸è´¯é€šã€‚</p>
</blockquote>
<h3 id="Reducing-Overfitting"><a href="#Reducing-Overfitting" class="headerlink" title="Reducing Overfitting"></a>Reducing Overfitting</h3><p>too many parameters in this model(60 million) are not insufficient to learn.</p>
<h4 id="1-Data-Augmentation"><a href="#1-Data-Augmentation" class="headerlink" title="1.Data Augmentation"></a>1.Data Augmentation</h4><ol>
<li><code>The first form of data augmentation consists of generating image translations and horizontal reflections.</code></li>
<li><code>The second form of data augmentation consists of altering the intensities of the RGB channels in
training images.</code>using PCA on the set.</li>
</ol>
<script type="math/tex; mode=display">[p1,p2,p3][\alpha_1 \lambda_1,\alpha_2 \lambda_2,\alpha_3 \lambda_3]^T</script><blockquote>
<p>ps: ç”±äºåŸæ¥çš„ç½‘ç»œæ¨¡å‹è¿‡æ·±ï¼Œæ‰€ä»¥éœ€è¦é¿å…è¿‡æ‹Ÿåˆï¼Œç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯å¢åŠ æ•°æ®é‡ï¼Œå¯ä»¥é€šè¿‡å¯¹å›¾åƒçš„ä¸€äº›å¤„ç†æ¥è¿›è¡Œï¼ŒåŒ…æ‹¬è¿›è¡Œå›¾åƒçš„è£å‰ªå’Œå¯¹é¢œè‰²è¿›è¡Œå¤„ç†ã€‚</p>
</blockquote>
<h4 id="2-Dropout"><a href="#2-Dropout" class="headerlink" title="2.Dropout"></a>2.Dropout</h4><p>dropout æ˜¯ä¸€ä¸ªé‡è¦çš„å†…å®¹ï¼Œæˆ‘åœ¨é™„åŠ çš„éƒ¨åˆ†ä¸»è¦è¯´æ˜ï¼Œè¿™é‡Œå°±ç›´æ¥è·³è¿‡ã€‚è¿™é‡Œä¹Ÿåªæ˜¯è¿ç”¨äº†è¿™ç§æ–¹æ³•ï¼Œæ²¡æœ‰åšä»€ä¹ˆä¿®æ”¹ã€‚</p>
<h3 id="5-Details-of-learning"><a href="#5-Details-of-learning" class="headerlink" title="5.Details of learning"></a>5.Details of learning</h3><p><code>We trained our models using stochastic gradient descent
with a batch size of 128 examples, momentum of 0.9, and
weight decay of 0.0005.</code></p>
<p><code>the update relu for weight w was</code>:</p>
<script type="math/tex; mode=display">v_{i+1} := 0.9v_i-0.0005 \epsilon w_i - \epsilon <\frac{\partial L}{\partial w}|_{w_i}>_{D_i}</script><script type="math/tex; mode=display">w_{i+1} := w_i+v_{i+1}</script><h3 id="6-Results"><a href="#6-Results" class="headerlink" title="6.Results"></a>6.Results</h3><p>this part is not so necessary, you should look through the paper to learn the result.</p>
<h3 id="7-Discussion"><a href="#7-Discussion" class="headerlink" title="7.Discussion"></a>7.Discussion</h3><p><code>the depth really is important for achieving our results</code>.you can see that, from the discussion in this paper, deep network on image classfication have been aroused. </p>
<h3 id="my-conclusion"><a href="#my-conclusion" class="headerlink" title="my conclusion"></a>my conclusion</h3><p>è¿™ç¯‡æ–‡ç« ä¸»è¦æå‡ºäº†AlexNetè¿™ç§ç»“æ„ï¼Œå…¶ä¸»è¦æœ‰å‡ ä¸ªä¸»è¦çš„å› ç´ æ„æˆï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸¤ä¸ªGPUäº¤äº’è®­ç»ƒçš„ç½‘ç»œ</li>
<li>ä½¿ç”¨dropoutæ–¹æ³•è¿›è¡Œæ­£åˆ™åŒ–çš„æ–¹æ³•</li>
<li>ä½¿ç”¨æ·±å±‚çš„æ·±åº¦ç½‘ç»œè¿›è¡Œå­¦ä¹ ï¼ˆè¿™æ˜¯ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦çš„å¼€ç«¯ï¼Œå®ƒæœ‰åæ¥çš„å·¥ä½œå¾ˆå¤§çš„å¯å‘ä½œç”¨ï¼‰</li>
<li>ä½¿ç”¨data augmentationæ¥è¿›è¡Œæ•°æ®çš„é¢„å¤„ç†ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li>
<li>ä½¿ç”¨äº†normalizationæ–¹æ³•æ¥å¤„ç†åŸæ¥çš„æ•°æ®ï¼ŒåŒæ—¶é‡‡ç”¨ReLUæ¿€æ´»å‡½æ•°ï¼Œä½¿å¾—æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æ›´åŠ å¿«æ·ï¼Œä¸”æ²¡æœ‰é™ä½æœ€ç»ˆçš„æ•ˆæœã€‚</li>
</ol>
<h3 id="å‘æ•£"><a href="#å‘æ•£" class="headerlink" title="å‘æ•£"></a>å‘æ•£</h3><h4 id="1-dropout"><a href="#1-dropout" class="headerlink" title="1. dropout"></a>1. dropout</h4><h4 id="2-æ·±å±‚çš„ç¥ç»ç½‘ç»œçš„é—®é¢˜åŠå…¶è§£å†³"><a href="#2-æ·±å±‚çš„ç¥ç»ç½‘ç»œçš„é—®é¢˜åŠå…¶è§£å†³" class="headerlink" title="2.æ·±å±‚çš„ç¥ç»ç½‘ç»œçš„é—®é¢˜åŠå…¶è§£å†³"></a>2.æ·±å±‚çš„ç¥ç»ç½‘ç»œçš„é—®é¢˜åŠå…¶è§£å†³</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Leliyliu</p>
              <p class="site-description motion-element" itemprop="description">record</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leliyliu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
